try{(function(global,factory){"use strict";if(!global.document){throw new Error("kLib requires a window with a document");}else{factory(global);}})(typeof window!=="undefined"?window:this,function(window){"use strict";var kLib=function kLib(options){return kLib.pt.options(options);};kLib.pt=kLib.prototype={version:version,constructor:kLib};kLib.options=kLib.pt.options=function options(options){kLib.extend(true,settings,options);kLib.reInitialize();return this;};kLib.reInitialize=function(){if(settings.chains.initChain.list().length>0){settings.chains.initChain.setData(settings);settings.chains.initChain.fire();}
return this;};function coreBuild(){if(typeof klevu_apiKey!=="undefined"){kLib.settings.search={apiKey:klevu_apiKey};kLib.settings.analytics={apiKey:klevu_apiKey};}
var overrideSettings=getAllUrlParameters();if(overrideSettings.length>0){kLib.each(overrideSettings,function(key,elem){if(elem.name.startsWith("klib_")){elem.name=elem.name.replace("klib_","").replace(new RegExp(/_/,"g"),".");setObjectPath(settings,elem.name,elem.value);}});}
kLib.interactive();kLib.ready();settings.chains.initChain=kLib.chain();};var version="2.3.5";var document=window.document;var objectTypes="Boolean Number String Function Array Date RegExp Object Error Symbol";var arr=[];var slice=arr.slice;var concat=arr.concat;var push=arr.push;var indexOf=arr.indexOf;var getProto=Object.getPrototypeOf;var class2type={};var toString=class2type.toString;var hasOwn=class2type.hasOwnProperty;var fnToString=hasOwn.toString;var ObjectFunctionString=fnToString.call(Object);var rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;var rnothtmlwhite=(/[^\x20\t\r\n\f]+/g);var rbracket=/\[\]$/;var r20=/%20/g;var rhash=/#.*$/;var rantiCache=/([?&])_=[^&]*/;var rheaders=/^(.*?):[ \t]*([^\r\n]*)$/mg;var rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/;var rprotocol=/^\/\//;var rnoContent=/^(?:GET|HEAD)$/;var rquery=(/\?/);var support={};var settings={url:{protocol:document.location.protocol,}};if(!String.prototype.startsWith){String.prototype.startsWith=function(search,pos){return this.substr(!pos||pos<0?0:+pos,search.length)===search;};}
if(!window.document.querySelectorAll){window.document.querySelectorAll=function(selectors){var style=window.document.createElement("style"),elements=[],element;window.document.documentElement.firstChild.appendChild(style);window.document._qsa=[];if(!style.styleSheet||typeof style.styleSheet.cssText==="undefined")return elements;style.styleSheet.cssText=selectors+"{x-qsa:expression(window.document._qsa && window.document._qsa.push(this))}";window.scrollBy(0,0);style.parentNode.removeChild(style);while(window.document._qsa.length){element=window.document._qsa.shift();element.style.removeAttribute("x-qsa");elements.push(element);}
window.document._qsa=null;return elements;};};if(!window.document.querySelector){window.document.querySelector=function(selectors){var elements=window.document.querySelectorAll(selectors);return(elements.length)?elements[0]:null;};};if(!Element.prototype.matches){Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(s){var matches=(this.document||this.ownerDocument).querySelectorAll(s),i=matches.length;while(--i>=0&&matches.item(i)!==this){}
return i>-1;};};if(!Array.prototype.filter){Array.prototype.filter=function(func,thisArg){"use strict";if(!((typeof func==="Function"||typeof func==="function")&&this))
throw new TypeError();var len=this.length>>>0,res=new Array(len),t=this,c=0,i=-1;if(thisArg===undefined){while(++i!==len){if(i in this){if(func(t[i],i,t)){res[c++]=t[i];}}}}
else{while(++i!==len){if(i in this){if(func.call(thisArg,t[i],i,t)){res[c++]=t[i];}}}}
res.length=c;return res;};}
if(!Array.prototype.forEach){Array.prototype.forEach=function(callback){var T,k;if(this===null){throw new TypeError("this is null or not defined");}
var O=Object(this);var len=O.length>>>0;if(typeof callback!=="function"){throw new TypeError(callback+" is not a function");}
if(arguments.length>1){T=arguments[1];}
k=0;while(k<len){var kValue;if(k in O){kValue=O[k];callback.call(T,kValue,k,O);}
k++;}};}
function queryString(params){var queryString=Object.keys(params).map(function(key){return key+'='+params[key]}).join('&');return queryString;}
function isUndefined(obj){return(typeof(obj)==="undefined");}
function noOp(){}
function isWindow(obj){return isUndefined(obj)&&obj!==null&&obj===obj.window;}
function DOMEval(code,doc,node){doc=doc||document;var i;var script=doc.createElement("script");var preservedScriptAttributes={type:true,src:true,noModule:true};script.text=code;if(node){for(i in preservedScriptAttributes){if(node[i]){script[i]=node[i];}}}
doc.head.appendChild(script).parentNode.removeChild(script);}
function globalEval(code){DOMEval(code);}
function isFunction(obj){return typeof obj==="function"&&typeof obj.nodeType!=="number";}
function toType(obj){if(obj===null){return obj+"";}
return typeof obj==="object"||typeof obj==="function"?class2type[toString.call(obj)]||"object":typeof obj;}
function isPlainObject(obj){var proto,Ctor;if(!obj||toString.call(obj)!=="[object Object]"){return false;}
proto=getProto(obj);if(!proto){return true;}
Ctor=hasOwn.call(proto,"constructor")&&proto.constructor;return typeof Ctor==="function"&&fnToString.call(Ctor)===ObjectFunctionString;}
function isEmptyObject(obj){for(var prop in obj){if(obj.hasOwnProperty(prop))
return false;}
return true;}
function explodeObjectPath(path){path=path.replace(new RegExp("[\\]]",["g"]),"").split(new RegExp("[\\[\\.]",["g"]));return path;}
function getObjectPathValue(object,path){var key=path.shift();if(path.length===0){return(!isUndefined(object[key]))?object[key]:undefined;}
return(!isUndefined(object[key]))?getObjectPathValue(object[key],path):undefined;}
function getObjectPath(object,path){if(!isUndefined(object)&&isPlainObject(object)){path=explodeObjectPath(path);return getObjectPathValue(object,path);}}
function setObjectPath(object,path,value){if(isUndefined(value))return object;path=explodeObjectPath(path);var index=-1,length=path.length,endIndex=length-1,nested=object;while(++index<length){var key=path[index];if(index===endIndex){nested[key]=value;}else if(isUndefined(nested[key])||nested[key]===null){nested[key]={};}
nested=nested[key];}
return object;}
function clean(obj){var propNames=Object.keys(obj);var functionLocal={check:function check(data){return data===null||data===undefined||data===[]||data==={}||data===false||data===0||data===""||((typeof data!=="number"&&typeof data!=="boolean")&&isEmptyObject(data));},filter:function filter(data){return!functionLocal.check(data);},sanitise:function sanitise(obj,propName){if(functionLocal.check(obj[propName])){delete obj[propName];return true;}
return false;}};for(var i=0;i<propNames.length;i++){var propName=propNames[i];if(!functionLocal.sanitise(obj,propName)){if(typeof obj[propName]==="object"){obj[propName]=clean(obj[propName]);if(isArrayLike(obj[propName])){obj[propName]=obj[propName].filter(functionLocal.filter);}
functionLocal.sanitise(obj,propName);}}}
return obj;}
function isEqualObj(value,other){var type=Object.prototype.toString.call(value);if(type!==Object.prototype.toString.call(other))return false;if(["[object Array]","[object Object]"].indexOf(type)<0)return false;var valueLen=type==="[object Array]"?value.length:Object.keys(value).length;var otherLen=type==="[object Array]"?other.length:Object.keys(other).length;if(valueLen!==otherLen)return false;var compare=function(item1,item2){var itemType=Object.prototype.toString.call(item1);if(["[object Array]","[object Object]"].indexOf(itemType)>=0){if(!isEqualObj(item1,item2))return false;}
else{if(itemType!==Object.prototype.toString.call(item2))return false;if(itemType==="[object Function]"){if(item1.toString()!==item2.toString())return false;}else{if(item1!==item2)return false;}}};if(type==="[object Array]"){for(var i=0;i<valueLen;i++){if(compare(value[i],other[i])===false)return false;}}else{for(var key in value){if(value.hasOwnProperty(key)){if(compare(value[key],other[key])===false)return false;}}}
return true;};function isArrayLike(obj){var length=!!obj&&"length"in obj&&obj.length,type=toType(obj);if(isFunction(obj)||isWindow(obj)){return false;}
return type==="array"||length===0||typeof length==="number"&&length>0&&(length-1)in obj;}
function inArray(elem,arr,i){return arr===null?-1:indexOf.call(arr,elem,i);}
function merge(first,second){var len=+second.length,j=0,i=first.length;for(;j<len;j++){first[i++]=second[j];}
first.length=i;return first;}
function makeArray(arr,results){var ret=results||[];if(arr!==null){if(isArrayLike(Object(arr))){merge(ret,typeof arr==="string"?[arr]:arr);}else{push.call(ret,arr);}}
return ret;}
function grep(elems,callback,invert){var callbackInverse,matches=[],i=0,length=elems.length,callbackExpect=!invert;for(;i<length;i++){callbackInverse=!callback(elems[i],i);if(callbackInverse!==callbackExpect){matches.push(elems[i]);}}
return matches;}
function map(elems,callback,arg){var length,value,i=0,ret=[];if(isArrayLike(elems)){length=elems.length;for(;i<length;i++){value=callback(elems[i],i,arg);if(value!==null){ret.push(value);}}}else{for(i in elems){value=callback(elems[i],i,arg);if(value!==null){ret.push(value);}}}
return concat.apply([],ret);}
function toArray(elem){return slice.call(elem);}
function toUniqueArray(array){if(!kLib.isArrayLike(array))return false;var unique=function unique(value,index,self){return self.indexOf(value)===index;};return array.filter(unique);}
function isNumeric(obj){var type=toType(obj);return(type==="number"||type==="string")&&!isNaN(obj-parseFloat(obj));}
function isString(obj){var type=toType(obj);return(type==="number"||type==="string");}
function trim(text){return text===null?"":(text+"").replace(rtrim,"");}
function each(obj,callback){var length,i=0;if(isArrayLike(obj)){length=obj.length;for(;i<length;i++){if(callback.call(obj[i],i,obj[i])===false){break;}}}else{for(i in obj){if(obj.hasOwnProperty(i)){if(callback.call(obj[i],i,obj[i])===false){break;}}}}
return obj;}
function explodeOptions(options){var object={};each(options.match(rnothtmlwhite)||[],function(_,flag){object[flag]=true;});return object;}
if(typeof Symbol==="function"){kLib.pt[Symbol.iterator]=arr[Symbol.iterator];}
each(explodeOptions(objectTypes),function(i){class2type["[object "+i+"]"]=i.toLowerCase();});function b64EncodeUnicode(str){return window.btoa(window.encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function(match,p1){return String.fromCharCode(parseInt(p1,16));}));}
function b64DecodeUnicode(str){return window.decodeURIComponent(Array.prototype.map.call(window.atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2);}).join(""));}
function getUrlParameter(sParam){var sPageURL=decodeURIComponent(window.location.search.substring(1)),sURLVariables=sPageURL.split("&"),sParameterName,i;for(i=0;i<sURLVariables.length;i++){sParameterName=sURLVariables[i].split("=");if(sParameterName[0]===sParam){return sParameterName[1]===undefined?false:sParameterName[1];}}}
function getAllUrlParameters(){var sPageURL=decodeURIComponent(window.location.search.substring(1)),sURLVariables=sPageURL.split("&"),sParameterName,i,returnArray=[];for(i=0;i<sURLVariables.length;i++){sParameterName=sURLVariables[i].split("=");returnArray.push({name:sParameterName[0],value:sParameterName[1]===undefined?false:sParameterName[1]});}
return returnArray;}
function getSetting(local,path,defaultVal,global){if(kLib.isUndefined(global))global={settings:kLib.settings};if(global===null)global={settings:kLib.settings};if(kLib.isUndefined(defaultVal))defaultVal=undefined;local={settings:local.settings};var localValue=kLib.getObjectPath(local,path);var globalValue=kLib.getObjectPath(global,path);if((!kLib.isUndefined(localValue))){if(isPlainObject(localValue)||Array.isArray(localValue)){return kLib.extend(true,{},kLib.extend(true,globalValue,localValue));}else{return localValue;}}else if(!kLib.isUndefined(globalValue)){return globalValue;}else{return defaultVal;}}
function getGlobalSetting(path,defaultVal){path="settings."+path;return getSetting({settings:{}},path,defaultVal,null);}
function setSetting(local,path,value,useGlobal){if(isUndefined(useGlobal))useGlobal=false;if(useGlobal){setObjectPath({settings:kLib.settings},path,value);}else{setObjectPath(local,path,value);}
return getSetting(local,path);}
function randomId(){function s4(){return Math.floor((1+Math.random())*0x10000).toString(16).substring(1);}
return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4();}
function hashCode(string){var hash=0,length=string.length,iterator=0;if(length>0)
while(iterator<length)
hash=(hash<<5)-hash+string.charCodeAt(iterator++)|0;return hash;};function buildParams(prefix,obj,add){var name;if(Array.isArray(obj)){kLib.each(obj,function(i,v){if(rbracket.test(prefix)){add(prefix,v);}else{buildParams(prefix+"["+(typeof v==="object"&&v!==null?i:"")+"]",v,add);}});}else if(toType(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],add);}}else{add(prefix,obj);}}
kLib.param=function(a){var prefix,s=[],add=function(key,valueOrFunction){var value=isFunction(valueOrFunction)?valueOrFunction():valueOrFunction;s[s.length]=encodeURIComponent(key)+"="+
encodeURIComponent(value===null?"":value);};if(Array.isArray(a)||(a.version&&!kLib.isPlainObject(a))){kLib.each(a,function(){add(this.name,this.value);});}else{for(prefix in a){buildParams(prefix,a[prefix],add);}}
return s.join("&");};function parseXML(data){var xml;if(!data||typeof data!=="string"){return null;}
try{xml=(new window.DOMParser()).parseFromString(data,"text/xml");}catch(e){xml=undefined;}
if(!xml||xml.getElementsByTagName("parsererror").length){kLib.error("Invalid XML: "+data);}
return xml;}
kLib.extend=kLib.pt.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[i]||{};i++;}
if(typeof target!=="object"&&!isFunction(target)){target={};}
if(i===length){target=this;i--;}
for(;i<length;i++){if((options=arguments[i])!==null){if(isPlainObject(options)&&options.hasOwnProperty("isKlevuChain")){target=kLib.chainClone(options);continue;}
for(name in options){src=target[name];copy=options[name];if(target===copy){continue;}
if(deep&&copy&&(kLib.isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&Array.isArray(src)?src:[];}else{clone=src&&kLib.isPlainObject(src)?src:{};}
if(copy.hasOwnProperty("isKlevuChain")){target[name]=kLib.chainClone(copy);}else{target[name]=kLib.extend(deep,clone,copy);}}else if(copy!==undefined){target[name]=copy;}}}}
return target;};kLib.extend({version:version,uid:"kLib-"+randomId(),class2type:class2type,support:support,settings:settings,type:toType,isFunction:isFunction,isWindow:isWindow,isUndefined:isUndefined,isPlainObject:isPlainObject,isEmptyObject:isEmptyObject,isEqualObj:isEqualObj,isNumeric:isNumeric,isString:isString,isArray:Array.isArray,isArrayLike:isArrayLike,inArray:inArray,makeArray:makeArray,toUniqueArray:toUniqueArray,parseJSON:JSON.parse,parseXML:parseXML,each:each,getObjectPath:getObjectPath,getObjectPathValue:getObjectPathValue,setObjectPath:setObjectPath,decode:b64DecodeUnicode,encode:b64EncodeUnicode,getUrlParameter:getUrlParameter,getSetting:getSetting,setSetting:setSetting,getGlobalSetting:getGlobalSetting,clean:clean,randomId:randomId,hashCode:hashCode,getAllUrlParameters:getAllUrlParameters,queryString:queryString,globalEval:globalEval});kLib.extend(true,settings,{console:{active:false,errorReporting:"stats.ksearchnet.com",level:1,type:{general:false,ajax:false,chain:false,translator:false,template:false,event:false,storage:false,assets:false}}});function sendReport(e,code){new Image().src="\/\/"+settings.console.errorReporting+"\/"+'error-log?type=jsv2&c='+code+'&m='+encodeURIComponent('{"error":"LOAD","extra": {"name":"'+e.name+'","line":"'+(e.lineNumber||e.line)+'","script":"'+(e.fileName||e.sourceURL||e.script)+'","stack":"'+(e.stackTrace||e.stack)+'","namespace":"kLib","message":"'+e.message+'"}}');}
function log(data){if(settings.console.active){console.log(data);}}
function logError(data){if(settings.console.level>=1){log(data);}}
function logWarning(data){if(settings.console.level>=2){log(data);}}
function logInfo(data){if(settings.console.level>=3){log(data);}}
function logDebug(data){if(settings.console.level>=4){log(data);}}
function error(msg){throw new Error(msg);}
kLib.extend({logError:logError,logWarning:logWarning,logInfo:logInfo,logDebug:logDebug,});kLib.css=kLib.pt.css={rawData:function(css){try{this.data=b64DecodeUnicode(css);}catch(e){this.data="";sendReport(e,"CSS-Decode");return;}
this.insertReplace();},link:function(url,name){if(isUndefined(name))name="kLib-css";kLib.dom.helpers.removeElementFromDocument("kLib-css");kLib.dom.helpers.addElementToHead({content:url,type:"css-link",name:name});},data:null,origData:null,insertReplace:function(){if(this.data!==this.origData){kLib.dom.helpers.removeElementFromDocument("kLib-css");kLib.dom.helpers.addElementToHead({content:this.data,type:"css",name:"kLib-css"});this.origData=this.data;return true;}}};kLib.extend(true,support,{css:true});kLib.extend(true,settings,{chains:{}});kLib.extend({chain:function(receivedOptions){var baseOptions={stopOnFalse:false,list:[],fireList:[],queue:[],firingIndex:-1,firing:false,fired:false,parameters:{},scope:{},spacer:10};var options=typeof receivedOptions==="string"?baseOptions:kLib.extend(baseOptions,receivedOptions);var memory;var fire=function(){options.fired=options.firing=true;for(;options.queue.length;options.firingIndex=-1){memory=options.queue.shift();while(++options.firingIndex<options.fireList.length){if(options.fireList[options.firingIndex].apply(memory[0],memory[1])===false&&options.stopOnFalse){options.firingIndex=options.fireList.length;memory=false;}}}
options.firing=false;};function regenerateFireList(){options.fireList=[];kLib.each(options.list,function(index,params){if(!isEmptyObject(params)&&isFunction(params.func))
options.fireList.push(params.func);});options.firingIndex=options.fireList.length;};var selfObj={list:function(){var returnList=[];kLib.each(options.list,function(i,data){if(!isEmptyObject(data)){returnList.push({name:data.name,position:i,function:data.func});}});return returnList;},indexOf:function(name){var index=-1;kLib.each(options.list,function(i,data){if(!isEmptyObject(data)&&data.name===name){index=i;return false;}});return index;},positionOf:function(name){var position=selfObj.indexOf(name);return(toType(position)!=="boolean")?position:false;},add:function(){if(options.list){(function add(args){kLib.each(args,function(_,arg){if(!isNumeric(arg.position)){arg.position=options.list.length+options.spacer;}
if(isFunction(arg.fire)){if(selfObj.indexOf(arg.name)!==-1){selfObj.remove({name:arg.name});}
var newObject={name:arg.name,func:arg.fire};if(isEmptyObject(options.list[arg.position])){options.list[arg.position]=newObject;}else{options.list.splice(arg.position,0,newObject);}}});})(arguments);regenerateFireList();}
return this;},addBefore:function(name,objectData){var position=selfObj.indexOf(name);if(position!==-1){objectData.position=position;selfObj.add(objectData);}
return this;},addAfter:function(name,objectData){var position=selfObj.indexOf(name);if(position!==-1){objectData.position=position+1;selfObj.add(objectData);}
return this;},remove:function(){kLib.each(arguments,function(_,arg){if(!isUndefined(arg.position)){if(!isEmptyObject(options.list[arg.position])){options.list.splice(arg.position,1,{});}}else if(!isUndefined(arg.name)){var position=selfObj.indexOf(arg.name);if(position>=0){options.list.splice(position,1,{});}}});regenerateFireList();return this;},move:function(){kLib.each(arguments,function(_,arg){if(!isUndefined(arg.name)){if(!isNumeric(arg.position)){if(arg.hasOwnProperty("before")){arg.position=selfObj.indexOf(arg.before);}else if(arg.hasOwnProperty("after")){arg.position=selfObj.indexOf(arg.after)+1;}}
var position=selfObj.indexOf(arg.name);if(position>=0){var clone=kLib.extend(true,{},options.list[position]);selfObj.remove({position:position});options.list.splice(arg.position,0,clone);regenerateFireList();}}});return this;},fireWith:function(context,args){args=args||[];args=[context,args.slice?args.slice():args];if(isUndefined(args[1][0])){if(selfObj.hasData()){args[1][0]=selfObj.getData();args[1].length=1;if(selfObj.hasScope()){args[1][1]=selfObj.getScope();args[1].length++;}}else{return this;}}else{options.parameters=args[1][0];if(!isUndefined(args[1][1])){options.scope=args[1][1];}}
options.queue.push(args);if(!options.firing){options.firingIndex=-1;fire();}
return this;},fire:function(){selfObj.fireWith(this,arguments);return this;},empty:function(){if(options.list){options.list=[];}
regenerateFireList();return this;},fired:function(){return options.fired;},stopOnFalse:function(stopOnFalse){options.stopOnFalse=stopOnFalse;return this;},hasData:function(){return(!isEmptyObject(options.parameters));},setData:function(data){options.parameters=data;options.fired=false;return this;},getData:function(){return options.parameters;},hasScope:function(){return(!isEmptyObject(options.scope));},setScope:function(scope){options.scope=scope;options.fired=false;return this;},getScope:function(){return options.scope;},regenerateFireList:regenerateFireList,getOptions:function(){return options;},options:options,isKlevuChain:true};return selfObj;},chainClone:function(chain){var newOptions={list:kLib.extend(true,[],chain.getOptions().list),parameters:kLib.extend(true,{},chain.getOptions().parameters),scope:kLib.extend(true,{},chain.getOptions().scope),stopOnFalse:kLib.extend(true,{},chain.getOptions().stopOnFalse)};var localChain=kLib.chain(newOptions);localChain.regenerateFireList();return localChain;}});kLib.extend(true,support,{chains:true});var nonce=Date.now();var prefilters={};var transports={};var allTypes="*/".concat("*");var originAnchor=document.createElement("a");originAnchor.href=location.href;function ajaxHandleResponses(s,klXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||klXHR.getResponseHeader("Content-Type");}}
if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break;}}}
if(dataTypes[0]in responses){finalDataType=dataTypes[0];}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break;}
if(!firstDataType){firstDataType=type;}}
finalDataType=finalDataType||firstDataType;}
if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType);}
return responses[finalDataType];}}
function ajaxConvert(s,response,klXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv];}}
current=dataTypes.shift();while(current){if(s.responseFields[current]){klXHR[s.responseFields[current]]=response;}
if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType);}
prev=current;current=dataTypes.shift();if(current){if(current==="*"){current=prev;}else if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2];}else if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1]);}
break;}}}}
if(conv!==true){if(conv&&s.throws){response=conv(response);}else{try{response=conv(response);}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current};}}}}}}
return{state:"success",data:response};}
function ajaxExtend(target,src){var key,deep,flatOptions=kLib.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:(deep||(deep={})))[key]=src[key];}}
if(deep){kLib.extend(true,target,deep);}
return target;};function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*";}
var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnothtmlwhite)||[];if(isFunction(func)){while((dataType=dataTypes[i++])){if(dataType[0]==="+"){dataType=dataType.slice(1)||"*";(structure[dataType]=structure[dataType]||[]).unshift(func);}else{(structure[dataType]=structure[dataType]||[]).push(func);}}}};}
function inspectPrefiltersOrTransports(structure,options,originalOptions,klXHR){var inspected={},seekingTransport=(structure===transports);function inspect(dataType){var selected;inspected[dataType]=true;kLib.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,klXHR);if(typeof dataTypeOrTransport==="string"&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return false;}else if(seekingTransport){return!(selected=dataTypeOrTransport);}});return selected;}
return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*");}
kLib.extend({lastModified:{},etag:{},ajaxSettings:{url:location.href,type:"GET",isLocal:rlocalProtocol.test(location.protocol),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":JSON.parse,"text xml":parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settingsAjax){return settingsAjax?ajaxExtend(ajaxExtend(target,kLib.ajaxSettings),settingsAjax):ajaxExtend(kLib.ajaxSettings,target);},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined;}
options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,urlAnchor,completed,i,uncached,s=kLib.ajaxSetup({},options),callbackContext=s.context||s,statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},strAbort="canceled",klXHR={readyState:0,callbacks:{},getResponseHeader:function(key){var match;if(completed){if(!responseHeaders){responseHeaders={};while((match=rheaders.exec(responseHeadersString))){responseHeaders[match[1].toLowerCase()]=match[2];}}
match=responseHeaders[key.toLowerCase()];}
return match==null?null:match;},getAllResponseHeaders:function(){return completed?responseHeadersString:null;},setRequestHeader:function(name,value){if(completed==null){name=requestHeadersNames[name.toLowerCase()]=requestHeadersNames[name.toLowerCase()]||name;requestHeaders[name]=value;}
return this;},overrideMimeType:function(type){if(completed==null){s.mimeType=type;}
return this;},statusCode:function(map){var code;if(map){if(completed){if(isFunction(map[klXHR.status])){map[klXHR.status](klXHR.responseObj);}}else{for(code in map){statusCode[code]=[statusCode[code],map[code]];}}}
return this;},abort:function(statusText){var finalText=statusText||strAbort;if(transport){transport.abort(finalText);}
done(0,finalText);return this;},requestDetails:s.requestDetails||{}};s.url=((url||s.url||location.href)+"").replace(rprotocol,location.protocol+"//");s.type=options.method||options.type||s.method||s.type;s.dataTypes=(s.dataType||"*").toLowerCase().match(rnothtmlwhite)||[""];if(s.crossDomain===null){urlAnchor=document.createElement("a");try{urlAnchor.href=s.url;urlAnchor.href=urlAnchor.href;s.crossDomain=originAnchor.protocol+"//"+originAnchor.host!==urlAnchor.protocol+"//"+urlAnchor.host;}catch(e){s.crossDomain=true;}}
if(s.data&&s.processData&&typeof s.data!=="string"){s.data=kLib.param(s.data);}
inspectPrefiltersOrTransports(prefilters,s,options,klXHR);if(completed){return klXHR;}
s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url.replace(rhash,"");if(!s.hasContent){uncached=s.url.slice(cacheURL.length);if(s.data&&(s.processData||typeof s.data==="string")){cacheURL+=(rquery.test(cacheURL)?"&":"?")+s.data;delete s.data;}
if(s.cache===false){cacheURL=cacheURL.replace(rantiCache,"$1");uncached=(rquery.test(cacheURL)?"&":"?")+"_="+(nonce++)+uncached;}
s.url=cacheURL+uncached;}else if(s.data&&s.processData&&(s.contentType||"").indexOf("application/x-www-form-urlencoded")===0){s.data=s.data.replace(r20,"+");}
if(s.ifModified){if(kLib.lastModified[cacheURL]){klXHR.setRequestHeader("If-Modified-Since",kLib.lastModified[cacheURL]);}
if(kLib.etag[cacheURL]){klXHR.setRequestHeader("If-None-Match",kLib.etag[cacheURL]);}}
if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){klXHR.setRequestHeader("Content-Type",s.contentType);}
klXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+
(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){klXHR.setRequestHeader(i,s.headers[i]);}
if(s.beforeSend&&(s.beforeSend.call(callbackContext,klXHR,s)===false||completed)){return klXHR.abort();}
strAbort="abort";klXHR.callbacks.done=s.done;klXHR.callbacks.success=s.success;klXHR.callbacks.fail=s.error;transport=inspectPrefiltersOrTransports(transports,s,options,klXHR);if(!transport){done(-1,"No Transport");}else{klXHR.readyState=1;if(completed){return klXHR;}
if(s.async&&s.timeout>0){timeoutTimer=window.setTimeout(function(){klXHR.abort("timeout");},s.timeout);}
try{completed=false;transport.send(requestHeaders,done);}catch(e){if(completed){throw e;}
done(-1,e);}}
function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(completed){return;}
completed=true;if(timeoutTimer){window.clearTimeout(timeoutTimer);}
transport=undefined;responseHeadersString=headers||"";klXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;if(responses){response=ajaxHandleResponses(s,klXHR,responses);}
response=ajaxConvert(s,response,klXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=klXHR.getResponseHeader("Last-Modified");if(modified){kLib.lastModified[cacheURL]=modified;}
modified=klXHR.getResponseHeader("etag");if(modified){kLib.etag[cacheURL]=modified;}}
if(status===204||s.type==="HEAD"){statusText="nocontent";}else if(status===304){statusText="notmodified";}else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error;}}else{error=statusText;if(status||!statusText){statusText="error";if(status<0){status=0;}}}
klXHR.status=status;klXHR.statusText=(nativeStatusText||statusText)+"";klXHR.responseObj=response;klXHR.isSuccess=isSuccess;if(isSuccess){if(isFunction(klXHR.callbacks.success)){klXHR.callbacks.success(klXHR);}}else{if(isFunction(klXHR.callbacks.fail)){klXHR.callbacks.fail(klXHR);}}
klXHR.statusCode(statusCode);statusCode=undefined;if(isFunction(klXHR.callbacks.done)){klXHR.callbacks.done(klXHR);}}
return klXHR;},getJSON:function(url,data,callback){return kLib.get(url,data,callback,"json");},getScript:function(url,callback){return kLib.get(url,undefined,callback,"script");}});kLib.each(["get","post"],function(i,method){kLib[method]=function(url,data,callback,type){if(isFunction(data)){type=type||callback;callback=data;data=undefined;}
return kLib.ajax(kLib.extend({url:url,type:method,dataType:type,data:data,success:callback},kLib.isPlainObject(url)&&url));};});kLib.ajaxPrefilter(function(s){if(s.crossDomain){s.contents.script=false;}});kLib.ajaxTransport(function(options){var callback,errorCallback;if(support.cors||xhrSupported&&!options.crossDomain){return{send:function(headers,complete){var i,xhr=options.xhr();xhr.open(options.type,options.url,options.async,options.username,options.password);if(options.xhrFields){for(i in options.xhrFields){xhr[i]=options.xhrFields[i];}}
if(options.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType);}
if(!options.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest";}
for(i in headers){xhr.setRequestHeader(i,headers[i]);}
callback=function(type){return function(){if(callback){callback=errorCallback=xhr.onload=xhr.onerror=xhr.onabort=xhr.ontimeout=xhr.onreadystatechange=null;if(type==="abort"){xhr.abort();}else if(type==="error"){if(typeof xhr.status!=="number"){complete(0,"error");}else{complete(xhr.status,xhr.statusText);}}else{complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,(xhr.responseType||"text")!=="text"||typeof xhr.responseText!=="string"?{binary:xhr.response}:{text:xhr.responseText},xhr.getAllResponseHeaders());}}};};xhr.onload=callback();errorCallback=xhr.onerror=xhr.ontimeout=callback("error");if(xhr.onabort!==undefined){xhr.onabort=errorCallback;}else{xhr.onreadystatechange=function(){if(xhr.readyState===4){window.setTimeout(function(){if(callback){errorCallback();}});}};}
callback=callback("abort");try{xhr.send(options.hasContent&&options.data||null);}catch(e){if(callback){throw e;}}},abort:function(){if(callback){callback();}}};}});kLib.ajaxSetup({accepts:{script:"text/javascript, application/javascript, "+"application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(text){globalEval(text);return text;}}});kLib.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false;}
if(s.crossDomain){s.type="GET";}});kLib.ajaxSettings.xhr=function(){try{return new window.XMLHttpRequest();}catch(e){}};var xhrSuccessStatus={0:200,1223:204};var xhrSupported=kLib.ajaxSettings.xhr();support.cors=!!xhrSupported&&("withCredentials"in xhrSupported);support.ajax=xhrSupported=!!xhrSupported;kLib.extend(true,settings,{fetchSettings:{url:location.href,method:"GET",processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},success:function(){},done:function(){},error:function(){}}});kLib.fetch=kLib.pt.fetch=function(requestObject,requestDetails){requestObject=klevu.extend(true,klevu.extend(true,{},klevu.fetchSettings),requestObject);var tempHeaders=new Headers({'Content-Type':requestObject.mimeType,});var settings={method:requestObject.method,headers:tempHeaders};if(requestObject.method.toLowerCase()==="get"){var url=new URL(requestObject.url);if(requestObject.data!==""){var params={q:requestObject.data};Object.keys(params).forEach(function(key,value){url.searchParams.append(value,params[value]);});}
requestObject.url=url.toString();}else{settings.body=requestObject.data}
if(requestObject.crossDomain)settings.mode='cors';var request=new Request(requestObject.url,settings);fetch(request).then(function(res){if(res.ok){var processor=null;if(!klevu.isUndefined(requestObject.dataType)){processor=requestObject.dataType.toLowerCase();}else{if(res.headers.get("content-type")!=null){if(res.headers.get("content-type").indexOf("json")!==-1){processor="json";}else if(res.headers.get("content-type").indexOf("xml")!==-1){processor="xml";}}}
switch(processor){case"json":res.json().then(function(data){requestObject.success(data,requestDetails,res.status,res.ok);});break;case"xml":res.text().then(function(data){requestObject.success((new window.DOMParser()).parseFromString(data,"text/xml"),requestDetails,res.status,res.ok);});break;default:res.text().then(function(data){requestObject.success(data,requestDetails,res.status,res.ok);});}}else{requestObject.error(requestDetails,res.status,res.ok);}},function(e){requestObject.error(requestDetails,"0",false);});};kLib.extend(true,settings,{request:{type:"FETCH",method:"GET",crossDomain:false,data:"",success:function(){},done:function(){},error:function(){}}});kLib.request=kLib.pt.request=function(requestObject,requestDetails){if(!isUndefined(requestObject)){requestObject=klevu.extend(true,klevu.extend(true,{},klevu.settings.request),requestObject);if(isUndefined(requestObject.url))return false;if(requestObject.type.toLowerCase()==="fetch"){delete requestObject["type"];klevu.fetch(requestObject,requestDetails);}else{delete requestObject["type"];kLib.setObjectPath(requestDetails,"context.requestDetails",{});kLib.setObjectPath(requestDetails,"context.requestObject",{});requestObject.requestDetails=requestDetails;klevu.ajax(requestObject);}}};kLib.get=kLib.pt.get=function(requestObject){requestObject.method="GET";kLib.request(requestObject);};kLib.post=kLib.pt.post=function(requestObject){requestObject.method="POST";kLib.request(requestObject);};kLib.extend(true,settings,{assets:{support:["template","js","css"]}});var assetsProcessors={js:function(data,options){kLib.dom.helpers.addElementToHead({content:data,type:"js",name:"kfl-"+randomId()});},css:function(data,options){kLib.dom.helpers.addElementToHead({content:data,type:"css",name:"kfl-"+randomId()});},template:function(data,options){klevu.search[options.pbid].getScope().template.setTemplate(data,options.name,true);},}
kLib.assets=kLib.pt.assets={getFile:function(fileObject){if(!fileObject.hasOwnProperty("url"))return false;if(!fileObject.hasOwnProperty("type"))return false;if(!fileObject.hasOwnProperty("options"))fileObject.options={};fileObject.options.url=fileObject.url;fileObject.options.type=fileObject.type;var requestDetails={success:function(data,options,status,isSuccess){kLib.assets.process(data,options);if(options.hasOwnProperty("successCallback"))options.successCallback(options);},error:function(data,options,status,isSuccess){if(options.hasOwnProperty("errorCallback"))options.errorCallback(options);},options:fileObject.options};var requestObject={url:fileObject.url,type:"FETCH",method:"GET",crossDomain:true};if(window.fetch){requestObject.success=function(data,requestDetails,status,isSuccess){requestDetails.success(data,requestDetails.options,status,isSuccess);};requestObject.error=function(requestDetails,status,isSuccess){requestDetails.error({},requestDetails.options,status,isSuccess);};}else{requestObject.success=function(klXHR){requestDetails.success(klXHR.responseObj.data,klXHR.requestDetails.options,klXHR.status,klXHR.isSuccess);};requestObject.error=function(klXHR){requestDetails.error({},klXHR.requestDetails.options,klXHR.status,klXHR.isSuccess);};}
kLib.request(requestObject,requestDetails);},process:function(data,options){if(!assetsProcessors.hasOwnProperty(options.type)){return false;}
assetsProcessors[options.type](data,options);},addProcessor:function(object){if(!object.hasOwnProperty("type"))return false;if(!object.hasOwnProperty("fire"))return false;assetsProcessors[object.type]=object.fire;},getProcessors:function(){return assetsProcessors;}};kLib.extend(true,support,{assets:true});var cacheObj={request:[],response:[],keys:0};kLib.cache=kLib.pt.cache=function(){var selfObj={getCache:function(req){var cacheKey=selfObj.getCacheKey(req);if(cacheKey>=0)return cacheObj.response[cacheKey];return false;},getCacheKey:function(req){var keyToReturn=-1;kLib.each(cacheObj.request,function(key,value){if(kLib.isEqualObj(req,value)){keyToReturn=key;return false;}});return keyToReturn;},hasCache:function(req){return(selfObj.getCacheKey(req)!==-1);},setCache:function(req,res){var cacheKey=selfObj.getCacheKey(req);if(cacheKey>=0){cacheObj.response[cacheKey]=res;}else{cacheObj.request[cacheObj.keys]=req;cacheObj.response[cacheObj.keys]=res;cacheObj.keys++;}
return true;},getAllCache:function(){return cacheObj;}};return selfObj;};kLib.extend(true,support,{cache:true});var globalDictionaryRepo={};kLib.extend({globalDictionaryRepo:globalDictionaryRepo});kLib.dictionary=kLib.pt.dictionary=function(type){var localSettings={dictionaryMap:{},type:type||"translation",storageType:null,storage:null,cookies:[]};if(isUndefined(globalDictionaryRepo[localSettings.type])){globalDictionaryRepo[localSettings.type]={};}
function storageTest(objectName){var test="test";try{window[objectName].setItem(test,test);window[objectName].removeItem(test);return true;}catch(e){return false;}}
function buildKey(key){return"klv_"+localSettings.type+"_"+key;}
function decodesKey(key){return key.replace(buildKey(""),"");}
function checkKey(key){return key.startsWith(buildKey(""));}
function getAllStorage(){var i=0,output={},sKey;for(;sKey=localSettings.storage.key(i);i++){if(sKey==="undefined")break;var value=localSettings.storage.getItem(sKey);if(value!==null){if(checkKey(sKey))
output[decodesKey(sKey)]=value;}}
return output;}
function getStorage(){if(localSettings.storage!==null)return localSettings.storage;return false;};function getStorageType(){if(localSettings.storageType!==null)return localSettings.storageType;return false;};function hasStorage(){return(localSettings.storageType!==null);}
function mergeToStorage(){if(hasStorage()){var storageElements=getAllStorage();each(storageElements,function(key,value){try{localSettings.storage.removeItem(buildKey(key));}catch(e){sendReport(e,"STORAGE-removeKey-"+buildKey(key));}});each(globalDictionaryRepo[localSettings.type],function(key,value){try{localSettings.storage.setItem(buildKey(key),value);}catch(e){sendReport(e,"STORAGE-addKey-"+buildKey(key));}});}}
function mergeFromStorage(){if(hasStorage()){var storageElements=getAllStorage();globalDictionaryRepo[localSettings.type]=kLib.extend(true,globalDictionaryRepo[localSettings.type],storageElements);}}
var selfObj={getGlobal:function(){mergeFromStorage();return globalDictionaryRepo[localSettings.type];},mergeToGlobal:function(){globalDictionaryRepo[localSettings.type]=kLib.extend(true,globalDictionaryRepo[localSettings.type],localSettings.dictionaryMap);mergeToStorage();return this;},overrideGlobal:function(){globalDictionaryRepo[localSettings.type]=localSettings.dictionaryMap;mergeToStorage();return this;},mergeFromGlobal:function(){mergeFromStorage();localSettings.dictionaryMap=kLib.extend(true,localSettings.dictionaryMap,globalDictionaryRepo[localSettings.type]);return this;},setElements:function(elements){if(isArrayLike(elements)){if(elements.length>0){each(elements,function(key,value){selfObj.addElement(key,value);});}}else if(isPlainObject(elements)){each(elements,function(key,value){selfObj.addElement(key,value);});}
return this;},getElements:function(){return localSettings.dictionaryMap;},resetElements:function(){localSettings.dictionaryMap={};return this;},getElement:function(string){if(isUndefined(string))return"";string=trim(string);if(!isUndefined(localSettings.dictionaryMap[string])&&!(localSettings.dictionaryMap[string]===null)){string=localSettings.dictionaryMap[string];}
return string;},addElement:function(valueDefault,valueOverride){localSettings.dictionaryMap[valueDefault]=valueOverride;return this;},removeElement:function(valueDefault){delete localSettings.dictionaryMap[valueDefault];return this;},getAllStorage:getAllStorage,setStorage:function(storage,fallback){if(isUndefined(fallback))fallback=false;try{var skip=false;if(storage==="local"&&storageTest("localStorage")){localSettings.storageType=storage;localSettings.storage=window["localStorage"];skip=true;}else if(fallback){storage="cookies";}
if(!skip){if(storage==="session"&&storageTest("sessionStorage")){localSettings.storageType=storage;localSettings.storage=window["sessionStorage"];}else if(fallback){storage="cookiesSession";}}
if(storage==="cookies"||storage==="cookiesSession"){localSettings.storageType=storage;localSettings.storage={getItem:function(sKey){if(!sKey||!this.hasOwnProperty(sKey)){return null;}
return decodeURI(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+encodeURI(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1"));},key:function(nKeyId){var keys=document.cookie.replace(/\s*\=(?:.(?!;))*$/,"").split(/\s*\=(?:[^;](?!;))*[^;]?;\s*/);var clone=kLib.extend(true,{},keys);each(clone,function(key,value){if(value.indexOf(buildKey(""))===-1){keys.splice(keys.indexOf(value),1);}});var key=decodeURI(keys[nKeyId]);return key;},setItem:function(sKey,sValue){if(!sKey){return;}
var dateString="";if(localSettings.storageType==="cookies"){var date=new Date();date.setTime(date.getTime()+(7*24*60*60*1000));dateString=" expires="+date.toUTCString()+";";}
document.cookie=encodeURI(sKey)+"="+encodeURI(sValue)+";"+dateString+" path=/";var lengthRegex=new RegExp(buildKey(""),["g"]);this.length=(document.cookie.match(lengthRegex)).length;},length:0,removeItem:function(sKey){if(!sKey||!this.hasOwnProperty(sKey)){return;}
document.cookie=encodeURI(sKey)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";this.length--;},hasOwnProperty:function(sKey){return(new RegExp("(?:^|;\\s*)"+encodeURI(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=")).test(document.cookie);}};var lengthRegex=new RegExp(buildKey(""),["g"]);localSettings.storage.length=(document.cookie.match(lengthRegex)).length;}
if(hasStorage()){mergeFromStorage();}}catch(e){sendReport(e,"STORAGE-storageSet-"+storage);}},getStorage:getStorage,getStorageType:getStorageType,hasStorage:hasStorage,mergeFromStorage:mergeFromStorage,mergeToStorage:mergeToStorage};return selfObj;};kLib.extend(true,support,{dictionary:true});kLib.extend(true,settings,{currency:{precision:2,grouping:3,decimal:".",thousand:","}});kLib.currency=kLib.pt.currency=function(){var dictionaryObj=kLib.dictionary("currency");var selfObj={getGlobal:dictionaryObj.getGlobal,mergeToGlobal:dictionaryObj.mergeToGlobal,overrideGlobal:dictionaryObj.overrideGlobal,mergeFromGlobal:dictionaryObj.mergeFromGlobal,setCurrencys:function(currencyMap){if(isPlainObject(currencyMap)){each(currencyMap,function(key,value){selfObj.addCurrency(key,value);});}
return this;},getCurrencys:dictionaryObj.getElements,resetCurrencys:dictionaryObj.resetElements,getCurrency:function(string){var map={};if(isUndefined(string))return map;string=trim(string);var local=dictionaryObj.getElement(string);if(local!==string){map=local;}else{map={code:string,string:string,atEnd:true,format:"%s%s"};}
return map;},addCurrency:function(valueCode,valueMap){if(!valueMap.hasOwnProperty("format"))valueMap.format="%s%s";if(!valueMap.hasOwnProperty("atEnd"))valueMap.atEnd=false;if(!valueMap.hasOwnProperty("code"))valueMap.code=valueCode;if(!valueMap.hasOwnProperty("precision"))valueMap.precision=settings.currency.precision;if(!valueMap.hasOwnProperty("thousand"))valueMap.thousand=settings.currency.thousand;if(!valueMap.hasOwnProperty("decimal"))valueMap.decimal=settings.currency.decimal;if(!valueMap.hasOwnProperty("grouping"))valueMap.grouping=settings.currency.grouping;if(valueMap.hasOwnProperty("code")&&valueMap.hasOwnProperty("string"))
dictionaryObj.addElement(valueCode,valueMap);return this;},removeCurrency:dictionaryObj.removeElement,parse:function(str){var args=[].slice.call(arguments,1),i=0;return str.replace(/(%s)/g,function(){var returnArgument="";if(!isUndefined(args[i]))returnArgument=args[i];i++;return returnArgument;});},unformatPrice:function(price,decimal){price=price||0;if(typeof price!=="number"){decimal=decimal||settings.currency.decimal;var regex=new RegExp("[^0-9-"+decimal+"]",["g"]);price=parseFloat((""+price).replace(/\((?=\d+)(.*)\)/,"-$1").replace(regex,"").replace(decimal,"."));price=!isNaN(price)?price:0;}
return price;},formatPrice:function(price){var args=arguments;var opts={precision:settings.currency.precision,thousand:settings.currency.thousand,decimal:settings.currency.decimal,grouping:settings.currency.grouping};if(typeof args[1]!=="undefined"){opts=(isPlainObject(args[1])?args[1]:opts);}
price=selfObj.unformatPrice(price,opts.decimal);var negative=price<0?"-":"",base=parseInt((Number(Math.round(Number(selfObj.unformatPrice(Math.abs(price||0))+"e"+opts.precision))+"e-"+opts.precision).toFixed(opts.precision)),10)+"",mod=base.length>opts.grouping?base.length%opts.grouping:0;return negative+(mod?base.substr(0,mod)+opts.thousand:"")+base.substr(mod).replace(/(\d{3})(?=\d)/g,"$1"+opts.thousand)+(opts.precision?opts.decimal+(Number(Math.round(Number(selfObj.unformatPrice(Math.abs(price))+"e"+opts.precision))+"e-"+opts.precision).toFixed(opts.precision)).split(".")[1]:"");},processCurrency:function(code,price){var currency=selfObj.getCurrency(code);price=selfObj.formatPrice(price,currency);if(currency.atEnd){price=selfObj.parse.apply(null,[currency.format,price,currency.string]);}else{price=selfObj.parse.apply(null,[currency.format,currency.string,price]);}
return price;}};return selfObj;};kLib.extend(true,support,{currency:true});kLib.translator=kLib.pt.translator=function(){var currencyObj=false;var dictionaryObj=kLib.dictionary("translation");var selfObj={getGlobal:dictionaryObj.getGlobal,mergeToGlobal:dictionaryObj.mergeToGlobal,overrideGlobal:dictionaryObj.overrideGlobal,mergeFromGlobal:dictionaryObj.mergeFromGlobal,setTranslations:dictionaryObj.setElements,getTranslations:dictionaryObj.getElements,resetTranslations:dictionaryObj.resetElements,getTranslation:dictionaryObj.getElement,addTranslation:dictionaryObj.addElement,removeTranslation:dictionaryObj.removeElement,parse:function(str){var args=[].slice.call(arguments,1),i=0;return str.replace(/(%s)/g,function(){var returnArgument="";if(!isUndefined(args[i]))returnArgument=args[i];i++;return returnArgument;});},translate:function(string){string=selfObj.getTranslation(string);if(string.length===0)return string;if(isArrayLike(arguments)){if(arguments.length>1){var args=arguments;args[0]=string;string=selfObj.parse.apply(null,args);}}
return string;},getCurrencyObject:function(){if(currencyObj){return currencyObj;}else{currencyObj=kLib.currency();}
return currencyObj;}};return selfObj;};kLib.extend(true,support,{translator:true});kLib.extend({template:function(){var templateSettings={templateList:{},helpers:{},data:{},translator:null,currency:null};function template(templateString,settingsTemplate){var templateSettingsGenerate={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapeRegExp=/\\|'|\r|\n|\u2028|\u2029/g;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};var escapeChar=function(match){return"\\"+escapes[match];};settingsTemplate=kLib.extend({},settingsTemplate,templateSettingsGenerate);var matcher=new RegExp([(settingsTemplate.escape||noMatch).source,(settingsTemplate.interpolate||noMatch).source,(settingsTemplate.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__out+='";templateString.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=templateString.slice(index,offset).replace(escapeRegExp,escapeChar);index=offset+match.length;if(escape){source+="'+\n((__temp=("+escape+"))==null?'':encodeURIComponent(__temp))+\n'";}else if(interpolate){source+="'+\n((__temp=("+interpolate+"))==null?'':__temp)+\n'";}else if(evaluate){source+="';\n"+evaluate+"\n__out+='";}
return match;});source+="';\n";if(!settingsTemplate.variable)source="with(data||{}){\n"+source+"}\n";source="var __temp,__out='',__joiner=Array.prototype.join,"+"print=function(){__out+=__joiner.call(arguments,'');};\n"+
source+"return __out;\n";var render;try{render=new Function(settingsTemplate.variable||"data","dataLocal","helper","scope",source);}catch(e){e.source=source;sendReport(e,"TEMPLATE-renderError");throw e;}
var template=function(data,dataLocal,helper,scope){if(isUndefined(scope)){scope=selfObj;}
if(isUndefined(data)){if(scope.hasData()){data=templateSettings.data;}}
if(isUndefined(dataLocal)){dataLocal=data;}
if(isUndefined(helper)){helper=getHelpers();}
return render.call(this,data,dataLocal,helper,scope);};var argument=settingsTemplate.variable||"data";var argumentLocal="dataLocal";var helper="helper";var scope="scope";template.source="function("+argument+","+argumentLocal+", "+helper+", "+scope+"){\n"+source+"}";return template;};function renderTemplate(name,scope,data,dataLocal,helper){if(isUndefined(scope)){scope=selfObj;}
if(data===undefined){if(scope.hasData()){data=scope.getTemplateSettings().data;}}
if(isUndefined(dataLocal)){dataLocal=data;}
if(isUndefined(helper)){helper=scope.getHelpers();}
if(isFunction(scope.getTemplateSettings().templateList[name])){return scope.getTemplateSettings().templateList[name](data,dataLocal,helper,scope);}else{return"";}}
function getHelpers(){return templateSettings.helpers;}
function setHelper(name,functionSource){if(isFunction(functionSource)){templateSettings.helpers[name]=functionSource;}
return templateSettings.helpers;}
function initTranslator(){templateSettings.translator=kLib.translator();setHelper("translator",templateSettings.translator);templateSettings.translator.mergeFromGlobal();setHelper("translate",templateSettings.translator.translate);setHelper("addTranslation",templateSettings.translator.addTranslation);setHelper("getTranslation",templateSettings.translator.getTranslation);setHelper("removeTranslation",templateSettings.translator.removeTranslation);setHelper("setTranslations",templateSettings.translator.setTranslations);templateSettings.currency=templateSettings.translator.getCurrencyObject();templateSettings.currency.mergeFromGlobal();setHelper("processCurrency",templateSettings.currency.processCurrency);return templateSettings.translator;}
initTranslator();function getTranslator(){return templateSettings.translator;}
function translate(){return getTranslator().translate.apply(null,arguments);}
function buildUrl(uri,key,value){var i=uri.indexOf("#");uri=i===-1?uri:uri.substr(0,i);var separator=uri.indexOf("?")!==-1?"&":"?";var re=new RegExp("([?&])"+key+"=.*?(&|$)","i");var keyval={};keyval[key]=value;keyval=kLib.param(keyval);if(uri.match(re)){return uri.replace(re,"$1"+keyval+"$2");}else{return uri+separator+keyval;}}
function stripHtml(string){string=string.replace(/(<([^>]+)>)/ig,"");return string;}
setHelper("render",renderTemplate);setHelper("each",kLib.each);setHelper("buildUrl",buildUrl);setHelper("stripHtml",stripHtml);var selfObj={getTemplateSettings:function(){return templateSettings;},setTemplateSettings:function(settings){templateSettings=settings;return templateSettings;},setTemplate:function(templateString,name,decoded){if(templateString===undefined||name===undefined){return false;}
decoded=decoded||false;if(!decoded){try{templateString=b64DecodeUnicode(templateString);}catch(e){this.data="";sendReport(e,"TEMPLATE-templateDecode");return false;}}
templateSettings.templateList[name]=template(templateString);return true;},render:renderTemplate,list:function(){var returnList=[];kLib.each(templateSettings.templateList,function(i,data){if(!isEmptyObject(data)){returnList.push({name:i,function:data.source});}});return returnList;},convertTemplate:function(htmlString){var div=document.createElement("div");div.innerHTML=trim(htmlString);div.className="klevuWrap";return div;},insertTemplate:function(node,element){node.appendChild(element);return node;},stripHtml:stripHtml,setHelper:setHelper,getHelpers:getHelpers,translate:translate,getTranslator:getTranslator,initTranslator:initTranslator,hasData:function(){return(!isEmptyObject(templateSettings.data));},setData:function(data){templateSettings.data=data;return this;},getData:function(){return templateSettings.data;}};return selfObj;},templateClone:function(source){var template=kLib.template();var localSettings=kLib.extend(true,{},source.getTemplateSettings());template.setTemplateSettings(localSettings);template.initTranslator();return template;}});kLib.extend(true,support,{template:true});kLib.extend(true,settings,{events:{maxExecutions:100,defaultDelay:0}});var events={};kLib.extend({isReady:false,isInteractive:false,event:{attach:function(target,event,callBack,useCapture){if(typeof addEventListener!=="undefined"){if(isUndefined(useCapture))useCapture=false;target.addEventListener(event,callBack,useCapture);}else{target.attachEvent("on"+event,callBack);}},fireChain:function(klevuObject,chainName,scope,data,event){var chain=kLib.getObjectPath(klevuObject,chainName);if(kLib.isUndefined(chain)||chain.list().length===0)return;chain.setScope(scope);chain.setData(data);chain.fire();if(chain.getData().preventDefault)event.preventDefault();return event;}},coreEvent:{build:function(object){object.maxCount=object.maxCount||settings.events.maxExecutions;object.delay=object.delay||settings.events.defaultDelay;if(isUndefined(object.name)||isUndefined(object.fire)||!isFunction(object.fire))return false;events[object.name]={fire:object.fire,counter:0,delay:object.delay,maxCount:object.maxCount};kLib.coreEvent.promise(name);},attach:function(name,object){if(isUndefined(name)||isUndefined(events[name]))return false;kLib.coreEvent.promise(name,object);},promise:function(name,object){if(isUndefined(name)||isUndefined(events[name]))return false;if(!settings.chains[name+"Chain"]){settings.chains[name+"Chain"]=startInterface.initChain();setTimeout(kLib.coreEvent.fire.bind(kLib,name),events[name].delay);}
startInterface.addToChain(settings.chains[name+"Chain"],object);if(events[name].fire.call(kLib)===true){kLib.coreEvent.fire(name);}},fire:function(name){if(isUndefined(name)||isUndefined(events[name]))return false;if(events[name].counter>=events[name].maxCount){return false;}
events[name].counter++;if(events[name].fire.call(kLib)===true){startInterface.fireChainAndClear(settings.chains[name+"Chain"]);events[name].counter=0;}else{setTimeout(kLib.coreEvent.fire.bind(kLib,name),events[name].delay);}}}});kLib.extend(true,support,{event:true,coreEvent:true});var startInterface={fireChainAndClear:function(chain){if(chain.list().length>0&&chain.hasData()){chain.fire();chain.empty();chain.setData({counter:0,list:[]});}},addToChain:function(chain,object){if(isFunction(object)){object={name:kLib.randomId(),fire:object};}else if(!isEmptyObject(object)){if(!object.name)object.name=kLib.randomId();}
if(object){if(isFunction(object.fire)){var internal=object.fire;object.fire=function(data,scope){internal.call(this,data.list[data.counter],scope);data.counter++;};};chain.add(object);var data=chain.getData();if(!object.data)object.data={};data.list.push(object.data);chain.setData(data);}},initChain:function(){var chain=kLib.chain();chain.setData({counter:0,list:[]});return chain;},events:{completedEvent:function(event){if(event.type==="load"||document.readyState==="complete"){startInterface.events.detachEvent();startInterface.interactiveFire();startInterface.readyFire();}else if(document.readyState==="interactive"){startInterface.interactiveFire();}},detachEvent:function(){if(document.addEventListener){document.removeEventListener("DOMContentLoaded",startInterface.events.completedEvent,false);window.removeEventListener("load",startInterface.events.completedEvent,false);}else{document.detachEvent("onreadystatechange",startInterface.events.completedEvent);window.detachEvent("onload",startInterface.events.completedEvent);}}},readyFire:function(){if(!document.body){return setTimeout(startInterface.readyFire);}
kLib.isInteractive=true;kLib.isReady=true;startInterface.fireChainAndClear(settings.chains.readyChain);},interactiveFire:function(){if(!document.body){return setTimeout(startInterface.interactiveFire);}
kLib.isInteractive=true;startInterface.fireChainAndClear(settings.chains.interactiveChain);},interactivePromise:function(object){if(document.readyState==="interactive")kLib.isInteractive=true;if(!settings.chains.interactiveChain){settings.chains.interactiveChain=startInterface.initChain();}
startInterface.addToChain(settings.chains.interactiveChain,object);if(kLib.isInteractive){startInterface.fireChainAndClear(settings.chains.interactiveChain);}},readyPromise:function(object){if(!settings.chains.readyChain){settings.chains.readyChain=startInterface.initChain();if(document.readyState==="complete"){setTimeout(startInterface.readyFire);}else if(document.addEventListener){document.addEventListener("DOMContentLoaded",startInterface.events.completedEvent,false);window.addEventListener("load",startInterface.events.completedEvent,false);}else{document.attachEvent("onreadystatechange",startInterface.events.completedEvent);window.attachEvent("onload",startInterface.events.completedEvent);var top=false;try{top=window.frameElement===null&&document.documentElement;}catch(e){}
if(top&&top.doScroll){(function doScrollCheck(){if(!kLib.isReady){try{top.doScroll("left");}catch(e){return setTimeout(doScrollCheck,50);}
startInterface.events.detachEvent();startInterface.readyFire();}})();}}}
startInterface.addToChain(settings.chains.readyChain,object);if(kLib.isReady){startInterface.fireChainAndClear(settings.chains.readyChain);}}};kLib.extend({ready:function(object){startInterface.readyPromise(object);},interactive:function(object){startInterface.interactivePromise(object);}});kLib.extend(true,support,{ready:true,interactive:true});kLib.extend({dom:{find:function(selector,node){if(isUndefined(node))node=window.document;if(kLib.isString(node)&&node!=="")node=window.document.getElementById(node);if(!kLib.dom.helpers.isHTMLNode(node)){node=window.document;}
if(!node.querySelectorAll)return document.querySelectorAll(node.id+" "+selector);return node.querySelectorAll(selector);},getFirst:function(selector,node){if(isUndefined(node))node=window.document;var result=kLib.dom.find(selector,node);if(result.length>0)return result[0];return result;},helpers:{isHTMLNode:function isNode(o){return(typeof Node==="object"?o instanceof Node:o&&typeof o==="object"&&typeof o.nodeType==="number"&&typeof o.nodeName==="string");},querySelectorAll:document.querySelectorAll,getClosest:function(node,selector){for(;node&&node!==document;node=node.parentNode){if(node.matches(selector))return node;}
return null;},addElementToHead:function addElementToHead(data){var element;if(isUndefined(data))return;if(data.type==="css"){element=document.createElement("style");element.type="text/css";element.id=data.name;if(element.styleSheet){element.styleSheet.cssText=data.content;}else{element.appendChild(document.createTextNode(data.content));}}else if(data.type==="js"){element=document.createElement("script");element.type="text/javascript";element.id=data.name;element.appendChild(document.createTextNode(data.content));}else if(data.type==="css-link"){element=document.createElement("link");element.setAttribute("rel","stylesheet");element.setAttribute("type","text/css");element.id=data.name;element.setAttribute("href",data.content);}
if(!isUndefined(element)){document.getElementsByTagName("head")[0].appendChild(element);}},removeElementFromDocument:function removeElementFromDocument(id){var elem=document.getElementById(id);if(!isUndefined(elem)&&elem)elem.parentNode.removeChild(elem);},addElementToParent:function(parent,child,options){if(isUndefined(parent)||parent===null)parent=window.document.body;var elem=document.createElement(child);for(var option in options){if(options.hasOwnProperty(option)){elem.setAttribute(option,options[option]);}}
parent.appendChild(elem);return elem;},getHTML:function getHTML(selector,node,offset){var listElement=kLib.dom.find(selector,node);if(isUndefined(offset))offset=0;if(!isNumeric(offset)&&isString(offset)&&offset!==""){switch(offset){case"first":offset=0;break;case"last":offset=listElement.length-1;break;default:offset=0;}}
if(isNumeric(offset))return kLib.dom.helpers.isHTMLNode(listElement[offset])?listElement[offset].innerHTML:"";return"";}}}});kLib.extend(true,support,{dom:true});kLib.time={timestamp:function(){return Math.floor(Date.now()/ 1000);}};kLib.extend(true,support,{time:true});coreBuild();if(isUndefined(window["klevu"])){window["klevu"]=kLib;kLib.reInitialize();if(typeof window.klevuInit==="function"){klevuInit();}}else{kLib.reInitialize();}
return kLib;});}catch(e){new Image().src="\/\/stats.ksearchnet.com\/"+'error-log?type=jsv2&c=initError&m='+encodeURIComponent('{"error":"LOAD","extra": {"name":"'+e.name+'","line":"'+(e.lineNumber||e.line)+'","script":"'+(e.fileName||e.sourceURL||e.script)+'","stack":"'+(e.stackTrace||e.stack)+'","namespace":"kLib","message":"'+e.message+'"}}');console.log(e);}
(function(klevu){klevu.extend({searchEvents:{functions:{}}});klevu.extend(true,klevu.searchEvents,{general:{documentClick:function(event){event=event||window.event;if(klevu.isUndefined(event.path)||klevu.isUndefined(event.path[0])||!klevu.isUndefined(event.path[0].kObject))return event;var data={event:event,preventDefault:false};klevu.event.fireChain(klevu.settings.chains,"documentClick",this,data,event);return event;},documentScroll:function(event){event=event||window.event;if(klevu.isUndefined(event.path)||klevu.isUndefined(event.path[0])||!klevu.isUndefined(event.path[0].kObject))return event;var data={event:event,preventDefault:false};klevu.event.fireChain(klevu.settings.chains,"documentScroll",this,data,event);return event;}},functions:{bindAllExtraEvents:{name:"interactive-search-extra-events",fire:function(){klevu.settings.chains.documentClick=klevu.chain({stopOnFalse:true});klevu.event.attach(document,"click",klevu.searchEvents.general.documentClick);var fullPageLayoutEnabled=klevu.getSetting(klevu.settings,"settings.search.fullPageLayoutEnabled",false);if(!klevu.isUndefined(fullPageLayoutEnabled)&&fullPageLayoutEnabled){klevu.settings.chains.documentScroll=klevu.chain({stopOnFalse:true});klevu.event.attach(window,"scroll",klevu.searchEvents.general.documentScroll);}}}}});klevu.extend(true,klevu.searchEvents,{box:{focus:function(event){event=event||window.event;this.kScope.data=this.kObject.resetData(this);this.kScope.data.context.keyCode=0;this.kScope.data.context.eventObject=event;this.kScope.data.context.event="focus";this.kScope.data.context.preventDefault=false;klevu.search.active=this.kObject;klevu.event.fireChain(this.kScope,"chains.events.focus",this,this.kScope.data,event);return event;},keyUp:function(event){event=event||window.event;this.kScope.data=this.kObject.resetData(this);this.kScope.data.context.keyCode=((event.keyCode)?event.keyCode:event.which);this.kScope.data.context.eventObject=event;this.kScope.data.context.event="keyUp";this.kScope.data.context.preventDefault=false;klevu.event.fireChain(this.kScope,"chains.events.keyUp",this,this.kScope.data,event);return event;},submit:function(event){event=event||window.event;this.kScope.data=this.kObject.resetData(this);this.kScope.data.context.keyCode=13;this.kScope.data.context.eventObject=event;this.kScope.data.context.event="submit";this.kScope.data.context.preventDefault=false;klevu.event.fireChain(this.kScope,"chains.events.submit",this,this.kScope.data,event);return event;}},functions:{bindAllSearchBoxes:{name:"interactive-search-boxes-activate",fire:function(){klevu.search.active=null;var searchBoxSelector=klevu.getSetting(klevu.settings,"settings.search.searchBoxSelector",klevu.randomId());var list=klevu.dom.find(searchBoxSelector);klevu.each(list,function(key,element){if(element.type==="text"||element.type==="search"||element.type==="input"){if(!klevu.isUndefined(element.kObject))return true;var search=klevu.searchObjectClone(klevu.search.base);search.getScope().element=element;element.kObject=search;element.kScope=element.kObject.getScope();element.kElem=element.kObject.getScope().element;var searchBoxTarget=klevu.getSetting(klevu.settings,"settings.search.searchBoxTarget",false);if(!searchBoxTarget){klevu.dom.helpers.addElementToParent(null,"div",{id:element.kScope.id,"class":"klevu-fluid"});klevu.setSetting(element.kScope.settings,"settings.search.searchBoxTarget",document.getElementById(element.kScope.id));}
searchBoxTarget=klevu.getSetting(element.kScope.settings,"settings.search.searchBoxTarget",false);searchBoxTarget.kObject=element.kObject;searchBoxTarget.kScope=element.kScope;searchBoxTarget.kElem=element.kElem;searchBoxTarget.classList.add("klevuTarget");klevu.event.attach(search.getScope().element,"focus",klevu.searchEvents.box.focus,true);klevu.event.attach(search.getScope().element,"keyup",klevu.searchEvents.box.keyUp,true);klevu.event.attach(search.getScope().element,"paste",function(event){setTimeout(function(){klevu.searchEvents.box.keyUp.call(event.target,event);},10);},true);if(element.form){element.form.kObject=search;element.form.kScope=element.form.kObject.getScope();element.form.kElem=element.form.kObject.getScope().element;klevu.event.attach(search.getScope().element.form,"submit",klevu.searchEvents.box.submit,true);}
search.getScope().element.setAttribute("autocomplete","off");var maxLength=klevu.getSetting(element.kScope.settings,"settings.search.maxChars",128);search.getScope().element.setAttribute("maxlength",maxLength);if(klevu.isUndefined(klevu.search["quick"]))klevu.extend(true,klevu.search,{quick:search});klevu.search.extraSearchBox.push(search);return true;}});}}}});klevu.coreEvent.build({name:"buildSearch",fire:function(){if(!klevu.isInteractive||klevu.isUndefined(klevu.search)||klevu.isUndefined(klevu.search.build)){return false;}
return true;}});klevu.coreEvent.attach("buildSearch",klevu.extend(true,{},klevu.searchEvents.functions.bindAllSearchBoxes));klevu.coreEvent.attach("buildSearch",klevu.extend(true,{},klevu.searchEvents.functions.bindAllExtraEvents));klevu.extend({searchObjectBuild:function(){var localVariables={cache:klevu.cache(),settings:{}};klevu.setObjectPath(localVariables,"id",klevu.randomId());klevu.setObjectPath(localVariables,"template",klevu.template());function resetTranslator(){klevu.setObjectPath(localVariables,"translator",localVariables.template.getTranslator());klevu.setObjectPath(localVariables,"currency",localVariables.translator.getCurrencyObject());}
resetTranslator();klevu.setObjectPath(localVariables,"chains.actions.doSearch",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.events.focus",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.events.keyUp",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.events.submit",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.processors.inputString",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.request.control",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.request.build",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.request.send",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.request.ajax.send",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.request.fetch.send",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.success",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.done",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.fail",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.ajax.success",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.ajax.done",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.ajax.fail",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.template.process.success",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.template.events",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.template.handleError",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.template.render",klevu.chain({stopOnFalse:true}));function init(){}
function resetData(scope){var tempData=buildData();if(scope.kScope.data.context.termOriginal!==scope.kElem.value){scope.kScope.data.localOverrides=tempData.localOverrides;}
scope.kScope.data.context=tempData.context;scope.kScope.data.context.term=scope.kElem.value;scope.kScope.data.context.termOriginal=scope.kElem.value;scope.kScope.data.request.current=tempData.request.current;scope.kScope.data.response.current=tempData.response.current;scope.kScope.data.template.suggestions=tempData.template.suggestions;scope.kScope.data.template.query=tempData.template.query;scope.kScope.data.template.settings=scope.kScope.data.context;scope.kScope.data.request.settings.object={};scope.kScope.data.response.ajax.object={};scope.kScope.data.response.ajax.data={};scope.kScope.data.response.data={};scope.kScope.data.response.object={};scope.kScope.data.scope=null;return scope.kScope.data;}
function buildData(){var data={context:{landingUrl:null,term:null,termOriginal:null,keyCode:0,eventObject:null,event:null,eventAction:"",preventDefault:false,status:null,isSuccess:false,doRequest:true},request:{settings:{url:null,object:{}},last:{},current:{context:{},suggestions:[],recordQueries:[]}},response:{ajax:{object:{},data:{}},current:{meta:{},suggestionResults:[],queryResults:[]}},localOverrides:{suggestion:{},query:{}},template:{settings:null,suggestions:{},query:{}}};data.template.settings=data.context;return data;}
function setTarget(elem){klevu.setSetting(this.getScope().settings,"settings.search.searchBoxTarget",elem);elem.kObject=this;elem.kScope=this.getScope();elem.kElem=this.getScope().element.kElem;elem.classList.add("klevuTarget");}
localVariables.data=buildData();var selfObj={init:init,resetData:resetData,buildData:buildData,setTarget:setTarget,setScope:function(variables){localVariables=variables;return localVariables;},getScope:function(){return localVariables;},getCache:function(){return localVariables.cache;},resetTranslator:resetTranslator};return selfObj;},searchObjectClone:function(source){var clone=klevu.searchObjectBuild();clone.setScope(klevu.extend(true,{},source.getScope()));clone.getScope().element=document.createElement("INPUT");clone.getScope().data=clone.buildData();clone.getScope().id=klevu.randomId();clone.getScope().template=klevu.templateClone(clone.getScope().template);clone.resetTranslator();clone.getScope().element.kObject=clone;clone.getScope().element.kScope=clone.getScope();clone.getScope().element.kElem=clone.getScope().element;return clone;}});var options={search:{searchBoxSelector:"input#search",searchBoxTarget:false,minChars:3,placeholder:"Search",showQuickOnEnter:false,fullPageLayoutEnabled:false,personalisation:false,redirects:[],map:{recordQuery:{"id":"","typeOfRequest":"","isFallbackQuery":false,"isBoostQuery":false,"settings":{"query":{"term":"","context":{"recentTerms":[],"recentObjects":[],"includeIds":[],"excludeIds":[]}},"typeOfRecords":["KLEVU_PRODUCT"],"groupBy":"","fields":[],"offset":0,"limit":0,"typeOfSearch":"","searchPrefs":[],"sort":"","priceFieldSuffix":"","fallbackWhenCountLessThan":0,"fallbackQueryId":"","personalisation":{"enablePersonalisation":false}},"filters":{"filtersToReturn":{"enabled":false,"options":{"order":"","limit":0,"minCount":0},"include":[],"exclude":[],"rangeFilterSettings":[{"key":"","minMax":false,"rangeInterval":0}]},"applyFilters":{"filters":[{"key":"","values":[],"settings":{"singleSelect":false}}]}},"boost":{"filters":[{"key":"","values":[],"weight":0}],"keywords":[{"phrase":"","weight":0}],"records":[{"id":"","weight":0}],"boostQueryId":""}},suggestions:{"id":"","query":"","typeOfRequest":"","limit":0,"includeFilters":false,"filterLimit":0,"applyFilters":[]}}}};klevu(options);})(klevu);(function(klevu){var baseSearch=klevu.searchObjectBuild();baseSearch.getScope().chains.events.focus.add({name:"check-placeholder",fire:function(data,scope){var placeholder=klevu.getSetting(scope.kScope.settings,"settings.search.placeholder");if(data.context.term.toLowerCase()===placeholder.toLowerCase()){scope.value="";return false;}}});baseSearch.getScope().chains.events.keyUp.add({name:"isCharacterNotAllowed",fire:function(data,scope){if(((data.context.keyCode>=9&&data.context.keyCode<=45)||(data.context.keyCode>=91&&data.context.keyCode<=93)||(data.context.keyCode>=112&&data.context.keyCode<=123))&&data.context.keyCode!==13&&data.context.keyCode!==32){return false;}
if(data.context.eventObject!==null){if(!klevu.isUndefined(data.context.eventObject.ctrlKey)&&data.context.eventObject.ctrlKey===true)return false;if(!klevu.isUndefined(data.context.eventObject.altKey)&&data.context.eventObject.altKey===true)return false;}}});baseSearch.getScope().chains.events.keyUp.add({name:"scrollToTop",fire:function(data,scope){var fullPageLayoutEnabled=klevu.getSetting(scope.kScope.settings,"settings.search.fullPageLayoutEnabled",false);if(fullPageLayoutEnabled){document.body.scrollTop=document.documentElement.scrollTop=0;}}});baseSearch.getScope().chains.events.keyUp.add({name:"doSearch",fire:function(data,scope){var chain=klevu.getObjectPath(scope.kScope,"chains.actions.doSearch");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();}
scope.kScope.data=data;if(data.context.preventDefault===true)return false;}});baseSearch.getScope().chains.events.submit.add({name:"checkRedirect",fire:function(data,scope){var redirects=klevu.getSetting(scope.kScope.settings,"settings.search.redirects",{});if(redirects){if(!klevu.isUndefined(redirects[data.context.term])){data.context.preventDefault=true;data.context.eventObject.preventDefault();document.location=redirects[data.context.term];}}
if(data.context.preventDefault===true)return false;}});baseSearch.getScope().chains.events.submit.add({name:"doSearch",fire:function(data,scope){var chain=klevu.getObjectPath(scope.kScope,"chains.actions.doSearch");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();}
scope.kScope.data=data;if(data.context.preventDefault===true)return false;}});baseSearch.getScope().chains.actions.doSearch.add({name:"showQuickOnEnter",fire:function(data,scope){var showQuickOnEnter=klevu.getSetting(scope.kScope.settings,"settings.search.showQuickOnEnter",false);if(data.context.keyCode===13&&showQuickOnEnter){if(data.context.event==="submit"){data.context.eventObject.preventDefault();}}}});baseSearch.getScope().chains.actions.doSearch.add({name:"checkInput",fire:function(data,scope){var chain=klevu.getObjectPath(scope.kScope,"chains.processors.inputString");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();}
scope.kScope.data=data;if(data.context.preventDefault===true)return false;}});baseSearch.getScope().chains.actions.doSearch.add({name:"doRequest",fire:function(data,scope){data.context.doSearch=false;var chain=klevu.getObjectPath(scope.kScope,"chains.request.control");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();scope.kScope.data=data;}else{data.context.preventDefault=true;scope.kScope.data=data;return false;}}});baseSearch.getScope().chains.processors.inputString.add({name:"checkDefined",fire:function(data,scope){if(klevu.isUndefined(data.context.term)){data.context.preventDefault=true;var chain=klevu.getObjectPath(scope.kScope,"chains.template.handleError");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData({section:"inputString",sector:"checkDefined"});chain.fire();}
return false;}}});baseSearch.getScope().chains.processors.inputString.add({name:"trim",fire:function(data,scope){data.context.term=data.context.term.replace(/\s{2,}/g," ").trim();}});baseSearch.getScope().chains.processors.inputString.add({name:"cleanDuplicatedSpaces",fire:function(data,scope){data.context.term=data.context.term.replace(/\s\s+/g," ");}});baseSearch.getScope().chains.processors.inputString.add({name:"checkLengthMin",fire:function(data,scope){var minLength=klevu.getSetting(scope.kScope.settings,"settings.search.minChars",0);if(data.context.term.length<minLength){var chain=klevu.getObjectPath(scope.kScope,"chains.template.handleError");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData({section:"inputString",sector:"checkLength"});chain.fire();}
data.context.preventDefault=true;return false;}}});baseSearch.getScope().chains.processors.inputString.add({name:"checkLengthMax",fire:function(data,scope){var maxLength=klevu.getSetting(scope.kScope.settings,"settings.search.maxChars",128);if(data.context.term.length>maxLength){var chain=klevu.getObjectPath(scope.kScope,"chains.template.handleError");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData({section:"inputString",sector:"checkLength"});chain.fire();}
data.context.preventDefault=true;return false;}}});baseSearch.getScope().chains.processors.inputString.add({name:"lowercase",fire:function(data,scope){data.context.term=data.context.term.toLowerCase();}});baseSearch.getScope().chains.processors.inputString.add({name:"checkPlaceholder",fire:function(data,scope){var placeholder=klevu.getSetting(scope.kScope.settings,"settings.search.placeholder","");if(data.context.term.toLowerCase()===placeholder.toLowerCase()){data.context.preventDefault=true;var chain=klevu.getObjectPath(scope.kScope,"chains.template.handleError");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData({section:"inputString",sector:"checkPlaceholder"});chain.fire();}
return false;}}});baseSearch.getScope().chains.request.ajax.send.add({name:"sendRequest",fire:function(data,scope){if(data.context.eventAction!=="searchAjax")return;data.scope=scope;if(data.context.doSearch){data.context.requestObject={url:data.request.settings.url,type:"AJAX",method:"POST",mimeType:"application/json; charset=UTF-8",contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:true,success:function(klXHR){var chain=klevu.getObjectPath(klXHR.requestDetails.scope.kScope,"chains.response.success");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(klXHR.requestDetails.scope.kElem);klevu.setObjectPath(klXHR.requestDetails,"response.data",klXHR.responseObj.data);klevu.setObjectPath(klXHR.requestDetails,"context.status",klXHR.status);klevu.setObjectPath(klXHR.requestDetails,"context.isSuccess",klXHR.isSuccess);chain.setData(klXHR.requestDetails);chain.fire();}},done:function(klXHR){var chain=klevu.getObjectPath(klXHR.requestDetails.scope.kScope,"chains.response.done");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(klXHR.requestDetails.scope.kElem);klevu.setObjectPath(klXHR.requestDetails,"response.data",klXHR.responseObj.data);klevu.setObjectPath(klXHR.requestDetails,"context.status",klXHR.status);klevu.setObjectPath(klXHR.requestDetails,"context.isSuccess",klXHR.isSuccess);chain.setData(klXHR.requestDetails);chain.fire();}},error:function(klXHR){var chain=klevu.getObjectPath(klXHR.requestDetails.scope.kScope,"chains.response.fail");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(klXHR.requestDetails.scope.kElem);klevu.setObjectPath(klXHR.requestDetails,"response.data",{});klevu.setObjectPath(klXHR.requestDetails,"context.status",klXHR.status);klevu.setObjectPath(klXHR.requestDetails,"context.isSuccess",klXHR.isSuccess);chain.setData(klXHR.requestDetails);chain.fire();}},data:JSON.stringify(data.request.settings.object),};data.context.requestDetails=klevu.extend(true,{},data);}else{}}});baseSearch.getScope().chains.request.fetch.send.add({name:"sendRequest",fire:function(data,scope){if(data.context.eventAction==="searchAjax")return;data.scope=scope;if(data.context.doSearch){data.context.requestObject={url:data.request.settings.url,type:"FETCH",method:"POST",mimeType:"application/json; charset=UTF-8",contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:true,success:function(data,requestDetails,status,isSuccess){var chain=klevu.getObjectPath(requestDetails.scope.kScope,"chains.response.success");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(requestDetails.scope.kElem);klevu.setObjectPath(requestDetails,"response.data",data);klevu.setObjectPath(requestDetails,"context.status",status);klevu.setObjectPath(requestDetails,"context.isSuccess",isSuccess);chain.setData(requestDetails);chain.fire();}},error:function(requestDetails,status,isSuccess){var chain=klevu.getObjectPath(requestDetails.scope.kScope,"chains.response.fail");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(requestDetails.scope.kElem);klevu.setObjectPath(requestDetails,"response.data",{});klevu.setObjectPath(requestDetails,"context.status",status);klevu.setObjectPath(requestDetails,"context.isSuccess",isSuccess);chain.setData(requestDetails);chain.fire();}},data:JSON.stringify(data.request.settings.object),};data.context.requestDetails=klevu.extend(true,{},data);}else{}}});baseSearch.getScope().chains.request.control.add({name:"initRequest",fire:function(data,scope){data.context.doSearch=false;data.request.original={};var chain=klevu.getObjectPath(scope.kScope,"chains.request.build");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();scope.kScope.data=data;if(data.context.doSearch===false)return false;}else{data.context.preventDefault=true;scope.kScope.data=data;return false;}}});baseSearch.getScope().chains.request.control.add({name:"setLocalOverrides",fire:function(data,scope){var query=klevu.getObjectPath(data.localOverrides,"query");if(!klevu.isUndefined(query)){klevu.each(query,function(key,value){var objectToChange=data.request.current.recordQueries.filter(function(query){return query.id==key;});if(objectToChange.length>0)objectToChange=klevu.extend(true,objectToChange[0],value);});}}});baseSearch.getScope().chains.request.control.add({name:"sanitiseRequestSuggestions",fire:function(data,scope){var requestObj=klevu.clean(data.request.current);data.response.current.suggestionResults=[];data.request.last.suggestionRequest={};var suggestion=klevu.getObjectPath(requestObj,"suggestions");data.request.original.suggestionResults=klevu.extend(true,{},suggestion);if(!klevu.isUndefined(suggestion)){klevu.each(suggestion,function(key,value){var cacheValue=scope.kScope.cache.getCache(value);if(cacheValue){data.response.current.suggestionResults.push(cacheValue);suggestion[key]={};}else{data.request.last.suggestionRequest[value.id]=value;}});}
data.request.settings.object=requestObj;}});baseSearch.getScope().chains.request.control.add({name:"sanitiseRequestQuery",fire:function(data,scope){var requestObj=klevu.clean(data.request.current);data.response.current.queryResults=[];data.request.last.queryRequest={};var query=klevu.getObjectPath(requestObj,"recordQueries");data.request.original.queryRequest=klevu.extend(true,{},query);if(!klevu.isUndefined(query)){var fallBackCount=0;klevu.each(query,function(key,value){var cacheValue=scope.kScope.cache.getCache(value);if(cacheValue){data.response.current.queryResults.push(cacheValue);query[key]={};}else{if(value.isFallbackQuery=="true"||value.isFallbackQuery===true){fallBackCount=fallBackCount+1;}
data.request.last.queryRequest[value.id]=value;}});requestObj=klevu.clean(requestObj);query=klevu.getObjectPath(requestObj,"recordQueries");if(!klevu.isUndefined(query)&&query.length===fallBackCount){klevu.setObjectPath(requestObj,"recordQueries",[]);}}
data.request.settings.object=requestObj;}});baseSearch.getScope().chains.request.control.add({name:"sanitiseRequestCheckIfAllCache",fire:function(data,scope){var requestObj=klevu.clean(data.request.current);data.request.settings.object=requestObj;if(klevu.isUndefined(requestObj.recordQueries)&&klevu.isUndefined(requestObj.suggestions)){data.context.isSuccess=true;data.context.doSearch=false;data.context.status=304;var chain=klevu.getObjectPath(scope.kScope,"chains.response.success");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();scope.kScope.data=data;if(data.context.doSearch===false)return false;}}}});baseSearch.getScope().chains.request.control.add({name:"generateURL",fire:function(data,scope){var searchUrl=klevu.getSetting(scope.kScope.settings,"settings.url.search",false);if(searchUrl){data.request.settings.url=searchUrl;}}});baseSearch.getScope().chains.request.control.add({name:"makeRequest",fire:function(data,scope){var chain=klevu.getObjectPath(scope.kScope,"chains.request.send");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();scope.kScope.data=data;return false;}}});baseSearch.getScope().chains.request.build.add({name:"buildMap",fire:function(data,scope){data.context.status=null;data.context.isSuccess=false;data.context.landingUrl=klevu.getSetting(scope.kScope.settings,"settings.url.landing",false);data.request.current.context.apiKeys=[klevu.getSetting(scope.kScope.settings,"settings.search.apiKey",klevu.getGlobalSetting("search.apiKey"))];data.request.requestObject={};}});baseSearch.getScope().chains.request.send.add({name:"checkFetch",fire:function(data,scope){if(window.fetch){data.context.eventAction="searchFetch";}else{data.context.eventAction="searchAjax";}}});baseSearch.getScope().chains.request.send.add({name:"requestTypeAjax",fire:function(data,scope){if(data.context.eventAction==="searchAjax"){var chain=klevu.getObjectPath(scope.kScope,"chains.request.ajax.send");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();scope.kScope.data=data;}}}});baseSearch.getScope().chains.request.send.add({name:"requestTypeFetch",fire:function(data,scope){if(data.context.eventAction!=="searchAjax"){var chain=klevu.getObjectPath(scope.kScope,"chains.request.fetch.send");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();scope.kScope.data=data;}}}});baseSearch.getScope().chains.request.send.add({name:"requestSend",fire:function(data,scope){klevu.request(data.context.requestObject,data.context.requestDetails);}});baseSearch.getScope().chains.response.success.add({name:"checkForSuccess",fire:function(data,scope){scope.kElem.data=data;if(data.context.isSuccess===false)return false;}});baseSearch.getScope().chains.response.success.add({name:"executeAjaxResponseProcessor",fire:function(data,scope){var chain=klevu.getObjectPath(scope.kScope,"chains.response.ajax.success");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();}
scope.kScope.data=data;}});baseSearch.getScope().chains.response.success.add({name:"addResponseDataSuggestion",fire:function(data,scope){var suggestion=klevu.getObjectPath(data.response.data,"suggestionResults");if(klevu.isUndefined(suggestion)){suggestion=[];}
if(suggestion.length>0){klevu.each(suggestion,function(key,value){if(!klevu.isUndefined(data.request.last.suggestionRequest[value.id])){scope.kScope.cache.setCache(data.request.last.suggestionRequest[value.id],value);}});}
data.response.current.suggestionResults=klevu.extend(true,data.response.current.suggestionResults,data.response.current.suggestionResults.concat(suggestion));}});baseSearch.getScope().chains.response.success.add({name:"addResponseDataQuery",fire:function(data,scope){var query=klevu.getObjectPath(data.response.data,"queryResults");if(klevu.isUndefined(query)){query=[];}
if(query.length>0){klevu.each(query,function(key,value){if(!klevu.isUndefined(data.request.last.queryRequest[value.id])){scope.kScope.cache.setCache(data.request.last.queryRequest[value.id],value);}});}
data.response.current.queryResults=klevu.extend(true,data.response.current.queryResults,data.response.current.queryResults.concat(query));}});baseSearch.getScope().chains.response.success.add({name:"processSuggestions",fire:function(data,scope){var suggestion=klevu.getObjectPath(data.response.current,"suggestionResults");if(!klevu.isUndefined(suggestion)){var suggestionProcessed={};klevu.each(suggestion,function(key,value){suggestionProcessed[value.id]=value.suggestions;});suggestion=suggestionProcessed;}else{suggestion={};}
data.template.suggestions=suggestion;scope.kScope.data=data;}});baseSearch.getScope().chains.response.success.add({name:"processQuery",fire:function(data,scope){var query=klevu.getObjectPath(data.response.current,"queryResults");if(!klevu.isUndefined(query)){var queryProcessed={};klevu.each(query,function(key,value){queryProcessed[value.id]={meta:value.meta,filters:value.filters,result:value.records};klevu.setObjectPath(data,"localOverrides.query."+value.id+".settings.typeOfSearch",value.meta.typeOfSearch);});query=queryProcessed;}else{query={};}
data.template.query=query;scope.kScope.data=data;}});baseSearch.getScope().chains.response.success.add({name:"executeTemplateResponseProcessor",fire:function(data,scope){var chain=klevu.getObjectPath(scope.kScope,"chains.template.process.success");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();}
scope.kScope.data=data;}});baseSearch.getScope().chains.response.success.add({name:"renderTemplate",fire:function(data,scope){var chain=klevu.getObjectPath(scope.kScope,"chains.template.render");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();}
scope.kScope.data=data;}});baseSearch.getScope().chains.response.success.add({name:"addEvents",fire:function(data,scope){var chain=klevu.getObjectPath(scope.kScope,"chains.template.events");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();}
scope.kScope.data=data;}});baseSearch.getScope().chains.template.handleError.add({name:"renderError",fire:function(data,scope){console.log(data.section);console.log(data.sector);return false;}});var KlevuElement=document.createElement("INPUT");KlevuElement.value="*";KlevuElement.kObject=baseSearch;KlevuElement.kScope=KlevuElement.kObject.getScope();baseSearch.getScope().element=KlevuElement;KlevuElement.kElem=KlevuElement.kObject.getScope().element;klevu.search={extraSearchBox:[],base:baseSearch,modules:{}};var landing=klevu.searchObjectClone(baseSearch);klevu.extend(true,klevu.search,{landing:landing});klevu.search.build=true;})(klevu);(function(klevu){klevu.extend({moiEvents:{filters:{moiFiltersClick:function(value,scope){klevu.event.attach(value,"click",function(event){event=event||window.event;var data={elem:this,event:event};var chain=klevu.moiEvents.filters.moiFiltersClickChain;if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope);chain.setData(data);chain.fire();}});},moiFiltersClickChain:klevu.chain({stopOnFalse:true})},product:{moiProductIntent:function(value,scope){klevu.event.attach(value,"click",function(event){event=event||window.event;var data={elem:this,event:event};var chain=klevu.moiEvents.product.moiProductIntentChain;if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope);chain.setData(data);chain.fire();}});},moiProductIntentChain:klevu.chain({stopOnFalse:true}),moiProductClick:function(value,scope){klevu.event.attach(value,"click",function(event){event=event||window.event;var data={elem:this,event:event};var chain=klevu.moiEvents.product.moiProductClickChain;if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope);chain.setData(data);chain.fire();}});},moiProductClickChain:klevu.chain({stopOnFalse:true})},menu:{moiMenuClick:function(value,scope){klevu.event.attach(value,"click",function(event){event=event||window.event;var data={elem:this,event:event};var chain=klevu.moiEvents.menu.moiMenuClickChain;if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope);chain.setData(data);chain.fire();}});},moiMenuClickChain:klevu.chain({stopOnFalse:true}),toggleMoiMenu:function(event){event=event||window.event;event.preventDefault();if(this.classList.contains(klevu.getSetting(this.moiScope.settings,"settings.moi.activeClass"))){klevu.moiEvents.menu.closeMoiMenu(this);}else{klevu.moiEvents.menu.openMoiMenu(this);}},openMoiMenu:function(scope){var element=klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.menuBox"),scope.moiScope.target);var clickItem=klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.menuBoxButton"),scope.moiScope.target);element.classList.add(klevu.getSetting(scope.moiScope.settings,"settings.moi.activeClass"));clickItem.classList.add(klevu.getSetting(scope.moiScope.settings,"settings.moi.activeClass"));},closeMoiMenu:function(scope){var element=klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.menuBox"),scope.moiScope.target);var clickItem=klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.menuBoxButton"),scope.moiScope.target);element.classList.remove(klevu.getSetting(scope.moiScope.settings,"settings.moi.activeClass"));clickItem.classList.remove(klevu.getSetting(scope.moiScope.settings,"settings.moi.activeClass"));},},buttons:{moiButtonsClick:function(value,scope){klevu.event.attach(value,"click",function(event){event=event||window.event;var data={elem:this,event:event};var chain=klevu.moiEvents.menu.moiMenuClickChain;if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope);chain.setData(data);chain.fire();}});},moiButtonsClickChain:klevu.chain({stopOnFalse:true})},forms:{moiFormSubmit:function(value,scope){klevu.event.attach(value,"submit",function(event){event=event||window.event;var dataForChain={elem:this,event:event,};var chain=klevu.moiEvents.forms.moiFormSubmitChain;if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope);chain.setData(dataForChain);chain.fire();}});},moiFormSubmitChain:klevu.chain({stopOnFalse:true})},display:{fixView:function(scope){var chain=klevu.moiEvents.display.fixViewChain;if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope);chain.setData({resize:true});chain.fire();}},fixViewChain:klevu.chain({stopOnFalse:true}),scrollToBottom:function(event){var container=klevu.dom.getFirst(klevu.getSetting(this.moiScope.settings,"settings.moi.chatList"),this.moiScope.target);container.scrollTop=container.scrollHeight;},openMoi:function(event){event=event||window.event;event.preventDefault();var element=this.moiScope.target;element.classList.add(klevu.getSetting(this.moiScope.settings,"settings.moi.activeClass"));if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.display)&&!klevu.isUndefined(klevu.moiEvents.display.fixView))klevu.moiEvents.display.fixView(this.moiScope.element);},closeMoi:function(event){event=event||window.event;event.preventDefault();var element=this.moiScope.target;element.classList.remove(klevu.getSetting(this.moiScope.settings,"settings.moi.activeClass"));},},overlay:{init:function(type,renderData,scope){if(type==="product"){klevu.moiEvents.overlay.renderProduct(renderData,scope);}
if(type==="customerSupport"){klevu.moiEvents.overlay.renderCustomerSupport(renderData,scope);}
if(type==="feedback"){klevu.moiEvents.overlay.renderFeedback(renderData,scope);}
if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.overlay))klevu.moiEvents.overlay.cancelLink(scope);if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.overlay))klevu.moiEvents.overlay.show(scope);},renderProduct:function(renderData,scope){var productContent=klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.productBlockContent"),renderData);scope.moiScope.template.setData({product:renderData.dataset["id"]});var tpl=scope.moiScope.template.convertTemplate(scope.moiScope.template.render("productOverlay"));klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.overlayProductBlock"),tpl).innerHTML=productContent.innerHTML;klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.overlayContent"),scope.moiScope.target).innerHTML=tpl.innerHTML;klevu.each(klevu.dom.find(klevu.getSetting(scope.moiScope.settings,"settings.moi.productDirectLink"),klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.overlayContent"),scope.moiScope.target)),function(key,value){if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.product))klevu.moiEvents.product.moiProductClick(value,scope);});},renderCustomerSupport:function(renderData,scope){scope.moiScope.template.setData(renderData);var tpl=scope.moiScope.template.convertTemplate(scope.moiScope.template.render("customerSupportOverlay"));klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.overlayContent"),scope.moiScope.target).innerHTML=tpl.innerHTML;klevu.each(klevu.dom.find(klevu.getSetting(scope.moiScope.settings,"settings.moi.overlayForm"),klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.overlayContent"),scope.moiScope.target)),function(key,value){if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.forms))klevu.moiEvents.forms.moiFormSubmit(value,scope);});},renderFeedback:function(renderData,scope){scope.moiScope.template.setData(renderData);var tpl=scope.moiScope.template.convertTemplate(scope.moiScope.template.render("feedbackOverlay"));klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.overlayContent"),scope.moiScope.target).innerHTML=tpl.innerHTML;klevu.each(klevu.dom.find(klevu.getSetting(scope.moiScope.settings,"settings.moi.overlayForm"),klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.overlayContent"),scope.moiScope.target)),function(key,value){if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.forms))klevu.moiEvents.forms.moiFormSubmit(value,scope);});},cancelLink:function(scope){klevu.each(klevu.dom.find(klevu.getSetting(scope.moiScope.settings,"settings.moi.overlayClose"),klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.overlay"),scope.moiScope.target)),function(key,value){klevu.event.attach(value,"click",function(event){event.preventDefault();if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.overlay))klevu.moiEvents.overlay.hide(scope);});});},hide:function(scope){klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.overlay"),scope.moiScope.target).style.display="none";},show:function(scope){klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.overlay"),scope.moiScope.target).style.display="block";}},message:{submitMessage:function(event){event=event||window.event;var dataForChain={elem:this,event:event,};var chain=klevu.moiEvents.message.submitMessageChain;if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(this.moiScope.element);chain.setData(dataForChain);chain.fire();}},submitMessageChain:klevu.chain({stopOnFalse:true}),keyUp:function(event){event=event||window.event;var dataForChain={elem:this,event:event,};var chain=klevu.moiEvents.message.keyUpChain;if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(this.moiScope.element);chain.setData(dataForChain);chain.fire();}},keyUpChain:klevu.chain({stopOnFalse:true}),},init:{bindTyping:function(moiObject){var elementInput=moiObject.getScope().element;klevu.event.attach(elementInput,"focus",klevu.moiEvents.display.scrollToBottom,true);klevu.event.attach(elementInput,"blur",klevu.moiEvents.display.scrollToBottom,true);if(elementInput.form){elementInput.form.moiObject=moiObject;elementInput.form.moiScope=elementInput.form.moiObject.getScope();elementInput.form.moiElem=elementInput.form.moiObject.getScope().element;klevu.event.attach(moiObject.getScope().element.form,"submit",klevu.moiEvents.message.submitMessage,true);klevu.moiEvents.init.initChatHistory(moiObject);}},initChatHistory:function(moiObject){var moiHistory=moiObject.getScope().history.getElement("chat");if(moiHistory==="chat"){moiHistory=[];}else{moiHistory=JSON.parse(moiHistory);}
if(moiHistory.length===0){klevu.event.fireChain(moiObject.getScope().element.moiScope,"chains.events.send",moiObject.getScope().element,moiObject.getScope().element.moiScope.data,null);}else{var chain=klevu.getObjectPath(moiObject.getScope().element.moiScope,"chains.process.processLine");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(moiObject.getScope().element);klevu.each(moiHistory,function(key,value){if(value.type==="message"){var displayData=value.data;displayData.fromHistory=true;klevu.event.fireChain(moiObject.getScope().element.moiScope,"chains.process.display",moiObject.getScope().element,displayData,null);}else if(value.type==="filter"||value.type==="products"){value.data.fromHistory=true;var lineData=value.data;chain.setData(lineData);chain.fire();}});}
var menuOptions=moiObject.getScope().history.getElement("menuOptions");if(menuOptions!=="menuOptions"){menuOptions=JSON.parse(menuOptions);menuOptions.line.fromHistory=true;chain.setData(menuOptions);chain.fire();}
var genericOptions=moiObject.getScope().history.getElement("genericOptions");if(genericOptions!=="genericOptions"){genericOptions=JSON.parse(genericOptions);genericOptions.line.fromHistory=true;chain.setData(genericOptions);chain.fire();}}}}}});klevu.moiEvents.filters.moiFiltersClickChain.add({name:"preverntDefaultSubmission",fire:function(data,scope){data.event.preventDefault();}});klevu.moiEvents.filters.moiFiltersClickChain.add({name:"activateFilter",fire:function(data,scope){data.elem.classList.toggle(klevu.getSetting(scope.moiScope.settings,"settings.moi.activeClass"));}});klevu.moiEvents.filters.moiFiltersClickChain.add({name:"collectData",fire:function(data,scope){scope.moiScope.data=scope.moiObject.resetData();var filterValues=[];var filterNames=[];klevu.each(klevu.dom.find(klevu.getSetting(scope.moiScope.settings,"settings.moi.filterAction")+".active",klevu.dom.helpers.getClosest(data.elem,klevu.getSetting(scope.moiScope.settings,"settings.moi.filters"))),function(key,element){filterValues.push(element.dataset.value);filterNames.push(element.innerHTML);});scope.moiScope.data.request.filter.value=filterValues.join(";");if(!scope.moiScope.data.request.filter.value){scope.moiScope.data.request.message=klevu.dom.helpers.getClosest(data.elem,klevu.getSetting(scope.moiScope.settings,"settings.moi.filters")).dataset["chatEmpty"];}else{scope.moiScope.data.request.message=klevu.dom.helpers.getClosest(data.elem,klevu.getSetting(scope.moiScope.settings,"settings.moi.filters")).dataset["chat"].replace(klevu.getSetting(scope.moiScope.settings,"settings.moi.filterSearchReplace"),filterNames.join(klevu.getSetting(scope.moiScope.settings,"settings.moi.filterDelimiterWord")));}
scope.moiScope.data.context.preventDefault=false;}});klevu.moiEvents.filters.moiFiltersClickChain.add({name:"printMessage",fire:function(data,scope){var displayData={displayType:"message",type:klevu.getSetting(scope.moiScope.settings,"settings.moi.rightClass"),message:scope.moiScope.data.request.message,tpl:null};klevu.event.fireChain(scope.moiScope,"chains.process.display",scope.moiScope.element,displayData,data.event);}});klevu.moiEvents.filters.moiFiltersClickChain.add({name:"send",fire:function(data,scope){klevu.event.fireChain(scope.moiScope,"chains.events.send",scope.moiScope.element,scope.moiScope.data,data.event);}});klevu.moiEvents.product.moiProductIntentChain.add({name:"preverntDefaultSubmission",fire:function(data,scope){data.event.preventDefault();}});klevu.moiEvents.product.moiProductIntentChain.add({name:"quickviewIntent",fire:function(data,scope){if(data.elem.dataset["intent"]==="quick-view"){if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.overlay))klevu.moiEvents.overlay.init("product",klevu.dom.helpers.getClosest(data.elem,klevu.getSetting(scope.moiScope.settings,"settings.moi.productBlock")),scope);return false;}}});klevu.moiEvents.product.moiProductIntentChain.add({name:"collectData",fire:function(data,scope){scope.moiScope.data=scope.moiObject.resetData();scope.moiScope.data.request.message=data.elem.dataset["chat"];var prodUrl=klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.productDirectLink"),klevu.dom.helpers.getClosest(data.elem,klevu.getSetting(scope.moiScope.settings,"settings.moi.productBlock")));var productBlock=klevu.dom.helpers.getClosest(data.elem,klevu.getSetting(scope.moiScope.settings,"settings.moi.productBlock"));scope.moiScope.data.request.product={id:productBlock.dataset["id"],intent:data.elem.dataset["intent"],context:{url:prodUrl.getAttribute('href')}};scope.moiScope.data.context.preventDefault=false;}});klevu.moiEvents.product.moiProductIntentChain.add({name:"printMessage",fire:function(data,scope){var displayData={displayType:"message",type:klevu.getSetting(scope.moiScope.settings,"settings.moi.rightClass"),message:scope.moiScope.data.request.message,tpl:null};klevu.event.fireChain(scope.moiScope,"chains.process.display",scope.moiScope.element,displayData,data.event);}});klevu.moiEvents.product.moiProductIntentChain.add({name:"send",fire:function(data,scope){klevu.event.fireChain(scope.moiScope,"chains.events.send",scope.moiScope.element,scope.moiScope.data,data.event);}});klevu.moiEvents.product.moiProductClickChain.add({name:"preverntDefaultSubmission",fire:function(data,scope){data.event.preventDefault();}});klevu.moiEvents.product.moiProductClickChain.add({name:"collectData",fire:function(data,scope){scope.moiScope.data=scope.moiObject.resetData();var prodUrl=klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.productDirectLink"),klevu.dom.helpers.getClosest(data.elem,klevu.getSetting(scope.moiScope.settings,"settings.moi.productBlock")));var productBlock=klevu.dom.helpers.getClosest(data.elem,klevu.getSetting(scope.moiScope.settings,"settings.moi.productBlock"));scope.moiScope.data.request.product={id:productBlock.dataset["id"],intent:"redirect",context:{url:prodUrl.getAttribute('href')}};scope.moiScope.data.context.preventDefault=false;}});klevu.moiEvents.product.moiProductClickChain.add({name:"overlayClose",fire:function(data,scope){if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.overlay))klevu.moiEvents.overlay.hide(scope);}});klevu.moiEvents.product.moiProductClickChain.add({name:"send",fire:function(data,scope){klevu.event.fireChain(scope.moiScope,"chains.events.send",scope.moiScope.element,scope.moiScope.data,data.event);}});klevu.moiEvents.forms.moiFormSubmitChain.add({name:"preverntDefaultSubmission",fire:function(data,scope){data.event.preventDefault();}});klevu.moiEvents.forms.moiFormSubmitChain.add({name:"validation",fire:function(data,scope){var validationPass=true;klevu.each(klevu.dom.find(klevu.getSetting(scope.moiScope.settings,"settings.moi.overlayFormItem"),data.elem),function(key,item){item.classList.remove(klevu.getSetting(scope.moiScope.settings,"settings.moi.overlayFormInvalid"));if(item.dataset.validations!==""){var validations=item.dataset.validations.split("");klevu.each(validations,function(key,validation){switch(validation){case"R":if(item.value===""){item.classList.add(klevu.getSetting(scope.moiScope.settings,"settings.moi.overlayFormInvalid"));validationPass=false;}
break;case"N":if(!klevu.isNumeric(item.value)){item.classList.add(klevu.getSetting(scope.moiScope.settings,"settings.moi.overlayFormInvalid"));validationPass=false;}
break;case"E":var check=/\S+@\S+\.\S+/;if(!check.test(item.value)){item.classList.add(klevu.getSetting(scope.moiScope.settings,"settings.moi.overlayFormInvalid"));validationPass=false;}
break;default:break;}});}});if(!validationPass)return false;}});klevu.moiEvents.forms.moiFormSubmitChain.add({name:"collectData",fire:function(data,scope){scope.moiScope.data=scope.moiObject.resetData();var formData={type:data.elem.dataset["type"],params:[]};klevu.each(klevu.dom.find(klevu.getSetting(scope.moiScope.settings,"settings.moi.overlayFormItem"),data.elem),function(key,item){formData.params.push({key:item.name,value:item.value});});scope.moiScope.data.request.form=formData;scope.moiScope.data.context.preventDefault=false;}});klevu.moiEvents.forms.moiFormSubmitChain.add({name:"closeOverlay",fire:function(data,scope){if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.overlay))klevu.moiEvents.overlay.hide(scope);}});klevu.moiEvents.forms.moiFormSubmitChain.add({name:"closeMoiMenu",fire:function(data,scope){if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.menu))klevu.moiEvents.menu.closeMoiMenu(scope);}});klevu.moiEvents.forms.moiFormSubmitChain.add({name:"send",fire:function(data,scope){klevu.event.fireChain(scope.moiScope,"chains.events.send",scope.moiScope.element,scope.moiScope.data,event);}});klevu.moiEvents.display.fixViewChain.add({name:"resizeChat",fire:function(data,scope){var buttonsBox=klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.buttonsBox"),scope.moiScope.target);var container=klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.chatList"),scope.moiScope.target);if(container.nodeType==1){container.style.cssText="min-height: calc(100% - "+buttonsBox.offsetHeight+"px);height: calc(100% - "+buttonsBox.offsetHeight+"px);";container.scrollTop=container.scrollHeight;}}});klevu.moiEvents.menu.moiMenuClickChain.add({name:"preverntDefaultSubmission",fire:function(data,scope){data.event.preventDefault();}});klevu.moiEvents.menu.moiMenuClickChain.add({name:"message",fire:function(data,scope){if(data.elem.dataset.action==="message"){scope.moiScope.data=scope.moiObject.resetData();scope.moiScope.data.request.message=data.elem.dataset["chat"];scope.moiScope.data.context.preventDefault=false;var displayData={displayType:"message",type:klevu.getSetting(scope.moiScope.settings,"settings.moi.rightClass"),message:scope.moiScope.data.request.message,tpl:null};klevu.event.fireChain(scope.moiScope,"chains.process.display",scope.moiScope.element,displayData,data.event);klevu.event.fireChain(scope.moiScope,"chains.events.send",scope.moiScope.element,scope.moiScope.data,data.event);}}});klevu.moiEvents.menu.moiMenuClickChain.add({name:"clearChat",fire:function(data,scope){if(data.elem.dataset.action==="clearChat"){scope.moiScope.data=scope.moiObject.resetData();scope.moiScope.data.request.message=data.elem.dataset["chat"];var chain=klevu.getObjectPath(scope.moiScope,"chains.process.actions");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);var actionData={type:"clearChat",context:{value:true}};chain.setData(actionData);chain.fire();}}}});klevu.moiEvents.menu.moiMenuClickChain.add({name:"customerSupport",fire:function(data,scope){if(data.elem.dataset.action==="customerSupport"){var options=JSON.parse(decodeURIComponent(data.elem.dataset.options));var dataToSend={chat:data.elem.dataset.chat,type:data.elem.dataset.action};if(klevu.isArray(options)&&options.length>0){klevu.each(options,function(index,line){if(line.key){dataToSend[line.key]={value:line.value,validations:line.validations,key:line.key}}});if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.overlay))klevu.moiEvents.overlay.init("customerSupport",dataToSend,scope);}}}});klevu.moiEvents.menu.moiMenuClickChain.add({name:"feedback",fire:function(data,scope){if(data.elem.dataset.action==="feedback"){var options=JSON.parse(decodeURIComponent(data.elem.dataset.options));var dataToSend={chat:data.elem.dataset.chat,type:data.elem.dataset.action};if(klevu.isArray(options)&&options.length>0){klevu.each(options,function(index,line){if(line.key){dataToSend[line.key]={value:line.value,validations:line.validations,key:line.key}}});if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.overlay))klevu.moiEvents.overlay.init("feedback",dataToSend,scope);}}}});klevu.moiEvents.menu.moiMenuClickChain.add({name:"closeMenu",fire:function(data,scope){if(data.elem.dataset.action!=="feedback"&&data.elem.dataset.action!=="customerSupport"){if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.menu))klevu.moiEvents.menu.closeMoiMenu(scope);}}});klevu.moiEvents.buttons.moiButtonsClickChain.add({name:"preverntDefaultSubmission",fire:function(data,scope){data.event.preventDefault();}});klevu.moiEvents.buttons.moiButtonsClickChain.add({name:"collectData",fire:function(data,scope){scope.moiScope.data=scope.moiObject.resetData();scope.moiScope.data.request.message=data.elem.dataset["chat"];scope.moiScope.data.context.preventDefault=false;}});klevu.moiEvents.buttons.moiButtonsClickChain.add({name:"printMessage",fire:function(data,scope){var displayData={displayType:"message",type:klevu.getSetting(scope.moiScope.settings,"settings.moi.rightClass"),message:scope.moiScope.data.request.message,tpl:null};klevu.event.fireChain(scope.moiScope,"chains.process.display",scope.moiScope.element,displayData,data.event);}});klevu.moiEvents.buttons.moiButtonsClickChain.add({name:"message",fire:function(data,scope){if(data.elem.dataset.action==="message"){klevu.event.fireChain(scope.moiScope,"chains.events.send",scope.moiScope.element,scope.moiScope.data,data.event);}}});klevu.moiEvents.buttons.moiButtonsClickChain.add({name:"clearChat",fire:function(data,scope){if(data.elem.dataset.action==="clearChat"){var chain=klevu.getObjectPath(scope.moiScope,"chains.process.actions");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);var actionData={type:"clearChat",context:{value:true}};chain.setData(actionData);chain.fire();}}}});klevu.moiEvents.message.submitMessageChain.add({name:"preverntDefaultSubmission",fire:function(data,scope){data.event.preventDefault();}});klevu.moiEvents.message.submitMessageChain.add({name:"checkForEmpty",fire:function(data,scope){if(data.elem.moiScope.element.value==="")return false;}});klevu.moiEvents.message.submitMessageChain.add({name:"collectData",fire:function(data,scope){scope.moiScope.data=scope.moiObject.resetData();scope.moiScope.data.request.message=data.elem.moiScope.element.value;scope.moiScope.data.context.preventDefault=false;scope.moiScope.element.value="";}});klevu.moiEvents.message.submitMessageChain.add({name:"printMessage",fire:function(data,scope){var displayData={displayType:"message",type:klevu.getSetting(scope.moiScope.settings,"settings.moi.rightClass"),message:scope.moiScope.data.request.message,tpl:null};klevu.event.fireChain(scope.moiScope,"chains.process.display",scope.moiScope.element,displayData,data.event);}});klevu.moiEvents.message.submitMessageChain.add({name:"send",fire:function(data,scope){klevu.event.fireChain(scope.moiScope,"chains.events.send",scope.moiScope.element,scope.moiScope.data,data.event);}});klevu.extend({moiObjectBuild:function(){var localVariables={settings:{}};klevu.setObjectPath(localVariables,"id",klevu.randomId());klevu.setObjectPath(localVariables,"history",klevu.dictionary("moiCache"));localVariables.history.setStorage("session");localVariables.history.mergeFromGlobal();klevu.setSetting(localVariables.settings,"settings.moi.lastMessage",(klevu.time.timestamp()-3600));if(localVariables.history.getElement("sessionId")!=="sessionId")klevu.setSetting(localVariables.settings,"settings.moi.sessionId",localVariables.history.getElement("sessionId"));klevu.setObjectPath(localVariables,"template",klevu.template());klevu.setObjectPath(localVariables,"chains.actions.doMoi",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.actions.finalise",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.events.send",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.request.control",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.request.build",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.request.send",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.request.ajax.send",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.success",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.done",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.fail",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.process.display",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.process.events",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.process.processLine",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.process.render",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.process.actions",klevu.chain({stopOnFalse:true}));function init(selfObj){localVariables.element=document.createElement("input");localVariables.element.moiObject=selfObj;localVariables.element.moiScope=localVariables;localVariables.element.moiElem=localVariables.element;}
function resetData(){var tempData=buildData();localVariables.data.context=tempData.context;localVariables.data.request=tempData.request;localVariables.data.response=tempData.response;localVariables.data.scope=null;return localVariables.data;}
function buildData(){var data={context:{klevuApiKey:null},request:{context:{sessionId:null,klevuApiKey:null},message:null,filter:{},product:{},form:{}},response:{current:{}},scope:{}};return data;}
localVariables.data=buildData();var selfObj={init:init,resetData:resetData,buildData:buildData,setScope:function(variables){localVariables=variables;return localVariables;},getScope:function(){return localVariables;}};init(selfObj);return selfObj;}});var options={moi:{dateDelay:900,moiTarget:'.moiContainer',chatList:'#chat',inputBox:'#message',buttonsBox:'.moiButtons',activateButton:'.toggleMoi',menuBox:'.moiMenu',menuBoxButton:'.toggleMoiMenu',products:'div.moiProductSlider',productAction:'a.action',productBlock:'.moiProductBlock',productBlockContent:'.moiProductContent',productDirectLink:'a.kumoiProductitem',productLink:'.moiProductlinks',productSlider:'.moiProductSlidesContainer',productSlide:'.moiSlides',productSliderArrow:'.moiSliderArrowNav',productSliderDots:'.moiSliderdot',filters:'div.kumoifilterList',filterAction:'a.kumoifiltername',buttonAction:'a.kumoifiltername',menuAction:'a.moi-menuOption',leftClass:'fromkumoi',rightClass:'fromUser',filterDelimiterWord:' and ',filterSearchReplace:"$VALUE$",overlay:'.kumoiOverlay',overlayContent:'.kumoiOverlayContent',overlayProductBlock:'.moiQuickViewProductBlock',overlayClose:'.kumoiOverlayClose',closeChat:'.Kumoi-Closeicon',overlayForm:'.moiQuickViewFormContent',overlayFormItem:'.moiQuickViewFormField',overlayFormError:'.moiQuickViewFormErrors',overlayFormInvalid:'invalid',activeClass:'active',inactiveClass:'inactive',disabledClass:'disabled',}};klevu(options);})(klevu);(function(klevu){var baseMoi=klevu.moiObjectBuild();baseMoi.getScope().chains.actions.doMoi.add({name:"doRequest",fire:function(data,scope){data.context.doRequest=false;var chain=klevu.getObjectPath(scope.moiScope,"chains.request.control");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);chain.setData(data);chain.fire();scope.moiScope.data=data;}else{data.context.preventDefault=true;scope.moiScope.data=data;return false;}}});baseMoi.getScope().chains.events.send.add({name:"generateURL",fire:function(data,scope){var moiUrl=klevu.getSetting(scope.moiScope.settings,"settings.url.moi",false);if(moiUrl){data.context.url=moiUrl;}else{return false;}}});baseMoi.getScope().chains.events.send.add({name:"addApiKey",fire:function(data,scope){var apiKey=klevu.getSetting(scope.moiScope.settings,"settings.moi.apiKey",false);if(apiKey){data.context.apiKey=apiKey;data.request.context.klevuApiKey=apiKey;}else{return false;}
var sessionKey=klevu.getSetting(scope.moiScope.settings,"settings.moi.sessionId",false);if(sessionKey){data.request.context.sessionId=sessionKey;}}});baseMoi.getScope().chains.events.send.add({name:"doMoi",fire:function(data,scope){var chain=klevu.getObjectPath(scope.moiScope,"chains.actions.doMoi");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);chain.setData(data);chain.fire();}
scope.moiScope.data=data;if(data.context.preventDefault===true)return false;}});baseMoi.getScope().chains.request.ajax.send.add({name:"sendRequest",fire:function(data,scope){if(data.context.eventAction!=="moiAjaxV1")return;data.scope=scope;if(data.context.doRequest){klevu.ajax({url:data.context.url,dataType:'json',contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify(data.request),crossDomain:true,success:function(klXHR){var chain=klevu.getObjectPath(klXHR.requestDetails.scope.moiScope,"chains.response.success");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(klXHR.requestDetails.scope.moiElem);klXHR.requestDetails.response=klXHR.responseObj.data.data;klXHR.requestDetails.context.status=klXHR.status;klXHR.requestDetails.context.isSuccess=klXHR.isSuccess;chain.setData(klXHR.requestDetails);chain.fire();}},done:function(klXHR){var chain=klevu.getObjectPath(klXHR.requestDetails.scope.moiScope,"chains.response.done");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(klXHR.requestDetails.scope.moiElem);klXHR.requestDetails.response=klXHR.responseObj.data.data;klXHR.requestDetails.context.status=klXHR.status;klXHR.requestDetails.context.isSuccess=klXHR.isSuccess;chain.setData(klXHR.requestDetails);chain.fire();}},error:function(klXHR){var chain=klevu.getObjectPath(klXHR.requestDetails.scope.moiScope,"chains.response.fail");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(klXHR.requestDetails.scope.moiElem);klXHR.requestDetails.response={};klXHR.requestDetails.context.status=klXHR.status;klXHR.requestDetails.context.isSuccess=klXHR.isSuccess;chain.setData(klXHR.requestDetails);chain.fire();}},requestDetails:data});}else{}}});baseMoi.getScope().chains.request.control.add({name:"initRequest",fire:function(data,scope){data.context.doRequest=false;var chain=klevu.getObjectPath(scope.moiScope,"chains.request.build");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);chain.setData(data);chain.fire();scope.moiScope.data=data;if(data.context.doRequest===false)return false;}else{data.context.preventDefault=true;scope.moiScope.data=data;return false;}}});baseMoi.getScope().chains.request.control.add({name:"sanitiseRequestSuggestions",fire:function(data,scope){data.request=klevu.clean(data.request);}});baseMoi.getScope().chains.request.control.add({name:"makeRequest",fire:function(data,scope){var chain=klevu.getObjectPath(scope.moiScope,"chains.request.send");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);chain.setData(data);chain.fire();scope.moiScope.data=data;return false;}}});baseMoi.getScope().chains.request.build.add({name:"buildMap",fire:function(data,scope){data.context.status=null;data.context.isSuccess=false;data.context.doRequest=true;}});baseMoi.getScope().chains.request.send.add({name:"requestTypeAjaxV1",fire:function(data,scope){data.context.eventAction="moiAjaxV1";}});baseMoi.getScope().chains.request.send.add({name:"requestTypeAjaxSendV1",fire:function(data,scope){if(data.context.eventAction==="moiAjaxV1"){var chain=klevu.getObjectPath(scope.moiScope,"chains.request.ajax.send");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);chain.setData(data);chain.fire();scope.moiScope.data=data;return false;}}}});baseMoi.getScope().chains.response.success.add({name:"checkForSuccess",fire:function(data,scope){scope.moiScope.data=data;if(data.context.isSuccess===false){return false;}
data.response=data.response;}});baseMoi.getScope().chains.response.success.add({name:"processByType",fire:function(data,scope){var buttonsBox=klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.buttonsBox"),scope.moiScope.target);if(buttonsBox.nodeType==1){buttonsBox.innerHTML="";}
var menuBox=klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.menuBox"),scope.moiScope.target);if(menuBox.nodeType==1){menuBox.innerHTML="";}
klevu.each(data.response,function(index,line){if(typeof line==='object'){var chain=klevu.getObjectPath(scope.moiScope,"chains.process.processLine");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);var lineData={line:line};chain.setData(lineData);chain.fire();}}});}});baseMoi.getScope().chains.process.actions.add({name:"clearChat",fire:function(data,scope){if(data.type==="clearChat"){if(data.context.value==true){var targetElements=klevu.dom.find(klevu.getSetting(scope.moiScope.settings,"settings.moi.chatList")+"> div",scope.moiScope.target);klevu.each(targetElements,function(key,elem){elem.parentNode.removeChild(elem);});}}}});baseMoi.getScope().chains.process.actions.add({name:"redirectToUrl",fire:function(data,scope){if(data.type==="redirectToUrl"){if(data.context.link!==null){window.location.href=data.context.link;}}}});baseMoi.getScope().chains.process.actions.add({name:"openMenu",fire:function(data,scope){if(data.type==="openMenu"){if(data.context.value==true){klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.menuBoxButton"),scope.moiScope.target).click();}}}});baseMoi.getScope().chains.process.actions.add({name:"closeChat",fire:function(data,scope){if(data.type==="closeChat"){if(data.context.value==true){klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.closeChat"),scope.moiScope.target).click();}}}});baseMoi.getScope().chains.process.display.add({name:"displayDate",fire:function(data,scope){if(data.displayType==="message"||data.displayType==="filter"||data.displayType==="product"){var lastMessage=klevu.getSetting(scope.moiScope.settings,"settings.moi.lastMessage",0);if(!("date"in data)){data.date=klevu.time.timestamp();}
klevu.setSetting(scope.moiScope.settings,"settings.moi.lastMessage",data.date);if((lastMessage+klevu.getSetting(scope.moiScope.settings,"settings.moi.dateDelay"))<(data.date)){var messageDate=new Date(data.date*1000);scope.moiScope.template.setData({message:messageDate.toLocaleDateString()+" "+messageDate.toLocaleTimeString()});var renderData={type:"line",tpl:scope.moiScope.template.convertTemplate(scope.moiScope.template.render("date"))};var chain=klevu.getObjectPath(scope.moiScope,"chains.process.render");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);chain.setData(renderData);chain.fire();}}}}});baseMoi.getScope().chains.process.display.add({name:"displayMessage",fire:function(data,scope){if(data.displayType==="message"){scope.moiScope.template.setData({className:data.type,message:data.message,note:data.note});var renderData={type:"line",tpl:scope.moiScope.template.convertTemplate(scope.moiScope.template.render("message"))};var chain=klevu.getObjectPath(scope.moiScope,"chains.process.render");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);chain.setData(renderData);chain.fire();}}}});baseMoi.getScope().chains.process.display.add({name:"displayFilters",fire:function(data,scope){if(data.displayType==="filter"){scope.moiScope.template.setData({className:klevu.getSetting(scope.moiScope.settings,"settings.moi.leftClass",false),message:data.filter.settings.label,options:data.filter.options,chatValue:data.filter.settings["chatFormat"],chatEmptyValue:data.filter.settings["chatFormatEmpty"],note:data.note});var renderData={type:"line",tpl:scope.moiScope.template.convertTemplate(scope.moiScope.template.render("filters"))};var chain=klevu.getObjectPath(scope.moiScope,"chains.process.render");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);chain.setData(renderData);chain.fire();}
data.tpl=renderData.tpl;}}});baseMoi.getScope().chains.process.display.add({name:"displayProducts",fire:function(data,scope){if(data.displayType==="product"){scope.moiScope.template.setData({className:klevu.getSetting(scope.moiScope.settings,"settings.moi.leftClass",false),products:data.products,note:data.note});var renderData={type:"line",tpl:scope.moiScope.template.convertTemplate(scope.moiScope.template.render("product"))};if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.slider))klevu.moiEvents.slider.init(renderData,scope);var chain=klevu.getObjectPath(scope.moiScope,"chains.process.render");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);chain.setData(renderData);chain.fire();}
data.tpl=renderData.tpl;}}});baseMoi.getScope().chains.process.display.add({name:"displayMenu",fire:function(data,scope){if(data.displayType==="menu"){scope.moiScope.template.setData({buttons:data.options});var renderData={type:"menu",optionCount:data.options.length,tpl:scope.moiScope.template.convertTemplate(scope.moiScope.template.render("menu"))};var chain=klevu.getObjectPath(scope.moiScope,"chains.process.render");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);chain.setData(renderData);chain.fire();}
data.tpl=renderData.tpl;}}});baseMoi.getScope().chains.process.display.add({name:"displayButtons",fire:function(data,scope){if(data.displayType==="buttons"){scope.moiScope.template.setData({buttons:data.options});var renderData={type:"buttons",optionCount:data.options.length,tpl:scope.moiScope.template.convertTemplate(scope.moiScope.template.render("buttons"))};var chain=klevu.getObjectPath(scope.moiScope,"chains.process.render");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);chain.setData(renderData);chain.fire();}
data.tpl=renderData.tpl;}}});baseMoi.getScope().chains.process.display.add({name:"saveHistory",fire:function(data,scope){if(data.fromHistory!==true){if(data.displayType==="message"){var moiHistory=scope.moiScope.history.getElement("chat");if(moiHistory==="chat"){moiHistory=new Array();}else{moiHistory=JSON.parse(moiHistory);}
data.date=klevu.time.timestamp();moiHistory.push({type:"message",from:data.type,data:data});scope.moiScope.history.addElement("chat",JSON.stringify(moiHistory));scope.moiScope.history.mergeToGlobal();}}}});baseMoi.getScope().chains.process.events.add({name:"filters",fire:function(data,scope){if(data.eventType==="filter"){klevu.each(klevu.dom.find(klevu.getSetting(scope.moiScope.settings,"settings.moi.filterAction"),data.tpl),function(key,value){if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.filters))klevu.moiEvents.filters.moiFiltersClick(value,scope);});}}});baseMoi.getScope().chains.process.events.add({name:"products",fire:function(data,scope){if(data.eventType==="product"){klevu.each(klevu.dom.find(klevu.getSetting(scope.moiScope.settings,"settings.moi.productAction"),data.tpl),function(key,value){if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.product))klevu.moiEvents.product.moiProductIntent(value,scope);});klevu.each(klevu.dom.find(klevu.getSetting(scope.moiScope.settings,"settings.moi.productDirectLink"),data.tpl),function(key,value){if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.product))klevu.moiEvents.product.moiProductClick(value,scope);});}}});baseMoi.getScope().chains.process.events.add({name:"menu",fire:function(data,scope){if(data.eventType==="menu"){klevu.each(klevu.dom.find(klevu.getSetting(scope.moiScope.settings,"settings.moi.menuAction"),data.tpl),function(key,value){if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.menu))klevu.moiEvents.menu.moiMenuClick(value,scope);});}}});baseMoi.getScope().chains.process.events.add({name:"buttons",fire:function(data,scope){if(data.eventType==="buttons"){klevu.each(klevu.dom.find(klevu.getSetting(scope.moiScope.settings,"settings.moi.buttonAction"),data.tpl),function(key,value){if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.buttons))klevu.moiEvents.buttons.moiButtonsClick(value,scope);});}}});baseMoi.getScope().chains.process.render.add({name:"renderLine",fire:function(data,scope){if(data.type==="line"){var container=klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.chatList"),scope.moiScope.target);if(container.nodeType==1){container.appendChild(data.tpl);container.scrollTop=container.scrollHeight;return true;}
return false;}}});baseMoi.getScope().chains.process.render.add({name:"renderMenu",fire:function(data,scope){if(data.type==="menu"){var menuBox=klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.menuBox"),scope.moiScope.target);var menuBoxButton=klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.menuBoxButton"),scope.moiScope.target);if(menuBox.nodeType==1){if(data.optionCount==0){menuBoxButton.classList.add(klevu.getSetting(scope.moiScope.settings,"settings.moi.disabledClass"));}else{menuBoxButton.classList.remove(klevu.getSetting(scope.moiScope.settings,"settings.moi.disabledClass"));}
menuBox.appendChild(data.tpl);data.tpl=menuBox;}}}});baseMoi.getScope().chains.process.render.add({name:"renderButtons",fire:function(data,scope){if(data.type==="buttons"){var buttonsBox=klevu.dom.getFirst(klevu.getSetting(scope.moiScope.settings,"settings.moi.buttonsBox"),scope.moiScope.target);if(buttonsBox.nodeType==1){if(data.optionCount>0){buttonsBox.classList.add(klevu.getSetting(scope.moiScope.settings,"settings.moi.activeClass"));}else{buttonsBox.classList.remove(klevu.getSetting(scope.moiScope.settings,"settings.moi.activeClass"));}
buttonsBox.appendChild(data.tpl);if(!klevu.isUndefined(klevu.moiEvents)&&!klevu.isUndefined(klevu.moiEvents.display)&&!klevu.isUndefined(klevu.moiEvents.display.fixView))klevu.moiEvents.display.fixView(scope);data.tpl=buttonsBox;}}}});baseMoi.getScope().chains.process.processLine.add({name:"initDate",fire:function(data,scope){if(!("date"in data.line))data.line.date=klevu.time.timestamp();}});baseMoi.getScope().chains.process.processLine.add({name:"context",fire:function(data,scope){if("context"in data.line){if(!klevu.isUndefined(data.line.context.sessionId)){klevu.setSetting(scope.moiScope.settings,"settings.moi.sessionId",data.line.context.sessionId);}}}});baseMoi.getScope().chains.process.processLine.add({name:"message",fire:function(data,scope){if("message"in data.line){if(data.line.message.type==="text"){var chain=klevu.getObjectPath(scope.moiScope,"chains.process.display");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);var displayData={displayType:"message",type:klevu.getSetting(scope.moiScope.settings,"settings.moi.leftClass"),message:data.line.message.value,note:data.line.message.note,date:data.line.date,tpl:null};chain.setData(displayData);chain.fire();}}}}});baseMoi.getScope().chains.process.processLine.add({name:"filter",fire:function(data,scope){if("filter"in data.line){var chain=klevu.getObjectPath(scope.moiScope,"chains.process.display");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);var displayData={displayType:"filter",filter:data.line.filter,note:data.line.filter.note,date:data.line.date,tpl:null};chain.setData(displayData);chain.fire();chain=klevu.getObjectPath(scope.moiScope,"chains.process.events");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);var eventData={eventType:"filter",filter:data.line.filter,tpl:displayData.tpl};chain.setData(eventData);chain.fire();}}}}});baseMoi.getScope().chains.process.processLine.add({name:"products",fire:function(data,scope){if("productData"in data.line){var chain=klevu.getObjectPath(scope.moiScope,"chains.process.display");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);var displayData={displayType:"product",products:data.line.productData.products,note:data.line.productData.note,date:data.line.date,tpl:null};chain.setData(displayData);chain.fire();chain=klevu.getObjectPath(scope.moiScope,"chains.process.events");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);var eventData={eventType:"product",products:data.line.productData.products,tpl:displayData.tpl};chain.setData(eventData);chain.fire();}}}}});baseMoi.getScope().chains.process.processLine.add({name:"menu",fire:function(data,scope){if("menuOptions"in data.line){var chain=klevu.getObjectPath(scope.moiScope,"chains.process.display");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);var displayData={displayType:"menu",options:data.line.menuOptions.options,tpl:null};chain.setData(displayData);chain.fire();chain=klevu.getObjectPath(scope.moiScope,"chains.process.events");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);var eventData={eventType:"menu",options:data.line.menuOptions.options,tpl:displayData.tpl};chain.setData(eventData);chain.fire();}}}}});baseMoi.getScope().chains.process.processLine.add({name:"buttons",fire:function(data,scope){if("genericOptions"in data.line){var chain=klevu.getObjectPath(scope.moiScope,"chains.process.display");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);var displayData={displayType:"buttons",options:data.line.genericOptions.options,tpl:null};chain.setData(displayData);chain.fire();chain=klevu.getObjectPath(scope.moiScope,"chains.process.events");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);var eventData={eventType:"buttons",options:data.line.genericOptions.options,tpl:displayData.tpl};chain.setData(eventData);chain.fire();}}}}});baseMoi.getScope().chains.process.processLine.add({name:"actions",fire:function(data,scope){if("actions"in data.line){if(data.line.actions.actions.length){klevu.each(data.line.actions.actions,function(index,line){var chain=klevu.getObjectPath(scope.moiScope,"chains.process.actions");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.moiElem);var actionData={type:line.type,context:line.context};chain.setData(actionData);chain.fire();}});}}}});baseMoi.getScope().chains.process.processLine.add({name:"saveHistory",fire:function(data,scope){if(data.fromHistory!==true){var moiHistory=scope.moiScope.history.getElement("chat");if(moiHistory==="chat"){moiHistory=new Array();}else{moiHistory=JSON.parse(moiHistory);}
if("context"in data.line){if(!klevu.isUndefined(data.line.context.sessionId)){scope.moiScope.history.addElement("sessionId",data.line.context.sessionId);}}
if("menuOptions"in data.line){scope.moiScope.history.addElement("menuOptions",JSON.stringify(data));}
if("genericOptions"in data.line){scope.moiScope.history.addElement("genericOptions",JSON.stringify(data));}
if("filter"in data.line){moiHistory.push({type:"filter",from:klevu.getSetting(scope.moiScope.settings,"settings.moi.leftClass"),data:data});}
if("productData"in data.line){moiHistory.push({type:"products",from:klevu.getSetting(scope.moiScope.settings,"settings.moi.leftClass"),data:data});}
if(moiHistory.length>100)moiHistory.splice(0,10);scope.moiScope.history.addElement("chat",JSON.stringify(moiHistory));scope.moiScope.history.mergeToGlobal();}}});klevu.moi={base:baseMoi};klevu.moi.build=true;})(klevu);(function(klevu){klevu.extend({analyticsEvents:{}});klevu.extend(true,klevu.analyticsEvents,{term:function(data,kObject){if(klevu.isEmptyObject(kObject))kObject=klevu.analytics.base;var kScope=kObject.getScope();kScope.data=kObject.resetData();kScope.data.context.eventAction="term";kScope.data.request.analytics=data;kScope.data.context.preventDefault=false;klevu.event.fireChain(kScope,"chains.events.term",kScope.element,kScope.data,null);return kObject;},click:function(data,kObject){if(klevu.isEmptyObject(kObject))kObject=klevu.analytics.base;var kScope=kObject.getScope();kScope.data=kObject.resetData();kScope.data.context.eventAction="click";kScope.data.request.analytics=data;kScope.data.request.analytics.klevu_type="clicked";kScope.data.context.preventDefault=false;klevu.event.fireChain(kScope,"chains.events.click",kScope.element,kScope.data,null);return kObject;},buy:function(data,kObject){if(klevu.isEmptyObject(kObject))kObject=klevu.analytics.base;var kScope=kObject.getScope();kScope.data=kObject.resetData();kScope.data.context.eventAction="buy";kScope.data.request.analytics=data;kScope.data.request.analytics.klevu_type="checkout";kScope.data.context.preventDefault=false;klevu.event.fireChain(kScope,"chains.events.buy",kScope.element,kScope.data,null);return kObject;},catclick:function(data,kObject){if(klevu.isEmptyObject(kObject))kObject=klevu.analytics.base;var kScope=kObject.getScope();kScope.data=kObject.resetData();kScope.data.context.eventAction="catclick";kScope.data.request.analytics=data;kScope.data.context.preventDefault=false;klevu.event.fireChain(kScope,"chains.events.catclick",kScope.element,kScope.data,null);return kObject;},catview:function(data,kObject){if(klevu.isEmptyObject(kObject))kObject=klevu.analytics.base;var kScope=kObject.getScope();kScope.data=kObject.resetData();kScope.data.context.eventAction="catview";kScope.data.request.analytics=data;kScope.data.context.preventDefault=false;klevu.event.fireChain(kScope,"chains.events.catview",kScope.element,kScope.data,null);return kObject;},collect:function(data){var kObject=klevu.analytics.base;var kScope=kObject.getScope();kScope.data=kObject.resetData();kScope.data.context.eventAction="collect";kScope.data.request.collect=data.toSend.payload;kScope.data.context.collectStorage=data.toSend;kScope.data.context.preventDefault=false;if(!klevu.isUndefined(data.callbacks)){kScope.data.context.callbacks=data.callbacks;}else{kScope.data.context.callbacks=false;}
klevu.event.fireChain(kScope,"chains.events.collect",kScope.element,kScope.data,null);return kObject;}});klevu.extend({analyticsObjectBuild:function(){var localVariables={settings:{}};klevu.setObjectPath(localVariables,"id",klevu.randomId());klevu.setObjectPath(localVariables,"chains.actions.doAnalytics",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.actions.finalise",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.events.term",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.events.click",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.events.buy",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.events.catview",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.events.catclick",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.events.collect",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.request.control",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.request.build",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.request.send",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.request.ajax.send",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.request.fetch.send",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.ajax.success",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.ajax.done",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.ajax.fail",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.success",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.done",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.fail",klevu.chain({stopOnFalse:true}));function init(selfObj){localVariables.element=document.createElement("input");localVariables.element.kObject=selfObj;localVariables.element.kScope=localVariables;localVariables.element.kElem=localVariables.element;}
function resetData(){var tempData=buildData();localVariables.data.context=tempData.context;localVariables.data.request=tempData.request;localVariables.data.response=tempData.response;localVariables.data.scope=null;return localVariables.data;}
function buildData(){var data={context:{event:null,eventAction:"",preventDefault:false,status:null,isSuccess:false,doRequest:true},request:{analytics:{}},response:{ajax:{object:{},data:{}},current:{}},scope:{}};return data;}
localVariables.data=buildData();var selfObj={init:init,resetData:resetData,buildData:buildData,setScope:function(variables){localVariables=variables;return localVariables;},getScope:function(){return localVariables;}};init(selfObj);return selfObj;}});var options={analytics:{url:{term:"n-search/search",click:"productTracking",buy:"productTracking",catclick:"categoryProductClickTracking",catview:"categoryProductViewTracking",collect:"collect"}},url:{analytics:klevu.settings.url.protocol+"//stats.klevu.com/analytics/",analyticsCat:klevu.settings.url.protocol+"//stats.ksearchnet.com/analytics/",analyticsCollect:klevu.settings.url.protocol+"//stats.ksearchnet.com/analytics/"}};klevu(options);(function(klevu){function sendAnalyticsEventsFromStorage(dictionary,element){var autoSug=klevu.dictionary(dictionary);autoSug.setStorage("local");autoSug.mergeFromGlobal();var storedEvents=autoSug.getElement(element);if(storedEvents&&storedEvents!=element){storedEvents=JSON.parse(storedEvents);klevu.each(storedEvents,function(index,value){delete value.filters;if(element==klevu.analyticsUtil.base.storage.click){klevu.analyticsEvents.click(value);}else if(element==klevu.analyticsUtil.base.storage.categoryClick){console.log(value);}else{klevu.analyticsEvents.term(value);}});autoSug.addElement(element,"");autoSug.mergeToGlobal();}};var storageOptions={dictionary:"analytics-util",term:"termList",click:"clickList",categoryClick:"categoryClickList",collect:"analyticsEvents"};klevu.extend({analyticsUtil:{base:{storage:storageOptions,sendAnalyticsEventsFromStorage:sendAnalyticsEventsFromStorage}}});klevu.extend(true,klevu,{analytics:{utility:{dictionary:{collect:"analyticsEvents"},sendAnalyticsEventsFromStorage:function(dictionary){var dictionaryData=klevu.dictionary(dictionary);dictionaryData.setStorage("local");dictionaryData.mergeFromGlobal();var storedEvents=dictionaryData.getElements();klevu.each(storedEvents,function(key,value){value=JSON.parse(value);if(klevu.getObjectPath(value,"type")===undefined)return false;if(value.type==="collect"){if("timestamp"in value){var currentTime=Math.floor((+new Date())/1000);if((currentTime-parseInt(value.timestamp))>21600){klevu.analytics.utility.removeAnalyticsEventsFromStorage(dictionary,key);return false;}}
var callbacks=[];callbacks.push({fire:klevu.analytics.utility.removeAnalyticsEventsFromStorage,params:[dictionary,key]});klevu.analyticsEvents.collect({toSend:value,callbacks:callbacks});}});dictionaryData.mergeToGlobal();},removeAnalyticsEventsFromStorage:function(dictionary,key){var dictionaryData=klevu.dictionary(dictionary);dictionaryData.setStorage("local");dictionaryData.mergeFromGlobal();dictionaryData.removeElement(key);dictionaryData.overrideGlobal();}}}});})(klevu);klevu.coreEvent.build({name:"analiticsAutosend",fire:function(){if(!klevu.isInteractive||klevu.isUndefined(klevu.analytics)||klevu.isUndefined(klevu.analytics.build)||klevu.isUndefined(klevu.analytics.utility)){return false;}
return true;}});klevu.coreEvent.attach("analiticsAutosend",function(){klevu.analytics.utility.sendAnalyticsEventsFromStorage("analyticsEvents")});})(klevu);(function(klevu){var baseAnalytics=klevu.analyticsObjectBuild();baseAnalytics.getScope().chains.events.term.add({name:"termRequestCheck",fire:function(data,scope){klevu.clean(data.request.analytics);var analytics=data.request.analytics;try{var hasError=false;var errorPrefix="";if(klevu.isUndefined(analytics.klevu_term)){hasError=true;errorPrefix="klevu_term";}else if(klevu.isUndefined(analytics.klevu_totalResults)){hasError=true;errorPrefix="klevu_totalResults";}else if(klevu.isUndefined(analytics.klevu_typeOfQuery)){hasError=true;errorPrefix="klevu_typeOfQuery";}
if(hasError){throw new Error(errorPrefix+" parameter is missing from the term analytics request!");}}catch(error){return false;}}});baseAnalytics.getScope().chains.events.term.add({name:"generateURL",fire:function(data,scope){var analyticsUrl=klevu.getSetting(scope.kScope.settings,"settings.url.analytics",false);if(analyticsUrl){data.context.url=analyticsUrl+klevu.getSetting(scope.kScope.settings,"settings.analytics.url.term",false);}else{return false;}}});baseAnalytics.getScope().chains.events.term.add({name:"addApiKey",fire:function(data,scope){data.request.analytics.klevu_apiKey=klevu.getSetting(scope.kScope.settings,"settings.analytics.apiKey",klevu.getGlobalSetting("analytics.apiKey"));}});baseAnalytics.getScope().chains.events.term.add({name:"doAnalytics",fire:function(data,scope){var chain=klevu.getObjectPath(scope.kScope,"chains.actions.doAnalytics");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();}
scope.kScope.data=data;if(data.context.preventDefault===true)return false;}});baseAnalytics.getScope().chains.events.click.add({name:"clickRequestCheck",fire:function(data,scope){klevu.clean(data.request.analytics);var analytics=data.request.analytics;try{var hasError=false;var errorPrefix="";if(klevu.isUndefined(analytics.klevu_keywords)){hasError=true;errorPrefix="klevu_keywords";}else if(klevu.isUndefined(analytics.klevu_productId)){hasError=true;errorPrefix="klevu_productId";}else if(klevu.isUndefined(analytics.klevu_productName)){hasError=true;errorPrefix="klevu_productName";}else if(klevu.isUndefined(analytics.klevu_productUrl)){hasError=true;errorPrefix="klevu_productUrl";}
if(hasError){throw new Error(errorPrefix+" parameter is missing from the click analytics request!");}}catch(error){return false;}}});baseAnalytics.getScope().chains.events.click.add({name:"generateURL",fire:function(data,scope){var analyticsUrl=klevu.getSetting(scope.kScope.settings,"settings.url.analytics",false);if(analyticsUrl){data.context.url=analyticsUrl+klevu.getSetting(scope.kScope.settings,"settings.analytics.url.click",false);}else{return false;}}});baseAnalytics.getScope().chains.events.click.add({name:"addApiKey",fire:function(data,scope){data.request.analytics.klevu_apiKey=klevu.getSetting(scope.kScope.settings,"settings.analytics.apiKey",klevu.getGlobalSetting("analytics.apiKey"));}});baseAnalytics.getScope().chains.events.click.add({name:"doAnalytics",fire:function(data,scope){var chain=klevu.getObjectPath(scope.kScope,"chains.actions.doAnalytics");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();}
scope.kScope.data=data;if(data.context.preventDefault===true)return false;}});baseAnalytics.getScope().chains.events.buy.add({name:"buyRequestCheck",fire:function(data,scope){klevu.clean(data.request.analytics);var analytics=data.request.analytics;try{var hasError=false;var errorPrefix="";if(klevu.isUndefined(analytics.klevu_productId)){hasError=true;errorPrefix="klevu_productId";}else if(klevu.isUndefined(analytics.klevu_unit)){hasError=true;errorPrefix="klevu_unit";}else if(klevu.isUndefined(analytics.klevu_salePrice)){hasError=true;errorPrefix="klevu_salePrice";}else if(klevu.isUndefined(analytics.klevu_currency)){hasError=true;errorPrefix="klevu_currency";}
if(hasError){throw new Error(errorPrefix+" parameter is missing from the buy analytics request!");}}catch(error){return false;}}});baseAnalytics.getScope().chains.events.buy.add({name:"generateURL",fire:function(data,scope){var analyticsUrl=klevu.getSetting(scope.kScope.settings,"settings.url.analytics",false);if(analyticsUrl){data.context.url=analyticsUrl+klevu.getSetting(scope.kScope.settings,"settings.analytics.url.buy",false);}else{return false;}}});baseAnalytics.getScope().chains.events.buy.add({name:"addApiKey",fire:function(data,scope){data.request.analytics.klevu_apiKey=klevu.getSetting(scope.kScope.settings,"settings.analytics.apiKey",klevu.getGlobalSetting("analytics.apiKey"));}});baseAnalytics.getScope().chains.events.buy.add({name:"doAnalytics",fire:function(data,scope){var chain=klevu.getObjectPath(scope.kScope,"chains.actions.doAnalytics");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();}
scope.kScope.data=data;if(data.context.preventDefault===true)return false;}});baseAnalytics.getScope().chains.events.catclick.add({name:"clickRequestCheck",fire:function(data,scope){klevu.clean(data.request.analytics);var analytics=data.request.analytics;try{var hasError=false;var errorPrefix="";if(klevu.isUndefined(analytics.klevu_categoryName)){hasError=true;errorPrefix="klevu_categoryName";}else if(klevu.isUndefined(analytics.klevu_categoryPath)){hasError=true;errorPrefix="klevu_categoryPath";}else if(klevu.isUndefined(analytics.klevu_productId)){hasError=true;errorPrefix="klevu_productId";}else if(klevu.isUndefined(analytics.klevu_productName)){hasError=true;errorPrefix="klevu_productName";}else if(klevu.isUndefined(analytics.klevu_productUrl)){hasError=true;errorPrefix="klevu_productUrl";}
if(hasError){throw new Error(errorPrefix+" parameter is missing from the click analytics request!");}}catch(error){return false;}}});baseAnalytics.getScope().chains.events.catclick.add({name:"generateURL",fire:function(data,scope){var analyticsUrl=klevu.getSetting(scope.kScope.settings,"settings.url.analyticsCat",false);if(analyticsUrl){data.context.url=analyticsUrl+klevu.getSetting(scope.kScope.settings,"settings.analytics.url.catclick",false);}else{return false;}}});baseAnalytics.getScope().chains.events.catclick.add({name:"addApiKey",fire:function(data,scope){data.request.analytics.klevu_apiKey=klevu.getSetting(scope.kScope.settings,"settings.analytics.apiKey",klevu.getGlobalSetting("analytics.apiKey"));}});baseAnalytics.getScope().chains.events.catclick.add({name:"doAnalytics",fire:function(data,scope){var chain=klevu.getObjectPath(scope.kScope,"chains.actions.doAnalytics");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();}
scope.kScope.data=data;if(data.context.preventDefault===true)return false;}});baseAnalytics.getScope().chains.events.catview.add({name:"viewRequestCheck",fire:function(data,scope){klevu.clean(data.request.analytics);var analytics=data.request.analytics;try{var hasError=false;var errorPrefix="";if(klevu.isUndefined(analytics.klevu_categoryName)){hasError=true;errorPrefix="klevu_categoryName";}else if(klevu.isUndefined(analytics.klevu_categoryPath)){hasError=true;errorPrefix="klevu_categoryPath";}else if(klevu.isUndefined(analytics.klevu_productIds)){hasError=true;errorPrefix="klevu_productIds";}
if(hasError){throw new Error(errorPrefix+" parameter is missing from the term analytics request!");}}catch(error){return false;}}});baseAnalytics.getScope().chains.events.catview.add({name:"generateURL",fire:function(data,scope){var analyticsUrl=klevu.getSetting(scope.kScope.settings,"settings.url.analyticsCat",false);if(analyticsUrl){data.context.url=analyticsUrl+klevu.getSetting(scope.kScope.settings,"settings.analytics.url.catview",false);}else{return false;}}});baseAnalytics.getScope().chains.events.catview.add({name:"addApiKey",fire:function(data,scope){data.request.analytics.klevu_apiKey=klevu.getSetting(scope.kScope.settings,"settings.analytics.apiKey",klevu.getGlobalSetting("analytics.apiKey"));}});baseAnalytics.getScope().chains.events.catview.add({name:"doAnalytics",fire:function(data,scope){var chain=klevu.getObjectPath(scope.kScope,"chains.actions.doAnalytics");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();}
scope.kScope.data=data;if(data.context.preventDefault===true)return false;}});baseAnalytics.getScope().chains.events.collect.add({name:"collectRequestClean",fire:function(data,scope){klevu.clean(data.request.collect);}});baseAnalytics.getScope().chains.events.collect.add({name:"generateURL",fire:function(data,scope){if(klevu.getObjectPath(scope.kScope,"data.context.collectStorage.url",false)){data.context.url=klevu.getObjectPath(scope.kScope,"data.context.collectStorage.url")+klevu.getSetting(scope.kScope.settings,"settings.analytics.url.collect",false);}else{var analyticsUrl=klevu.getSetting(scope.kScope.settings,"settings.url.analyticsCollect",false);if(analyticsUrl){data.context.url=analyticsUrl+klevu.getSetting(scope.kScope.settings,"settings.analytics.url.collect",false);}else{return false;}}}});baseAnalytics.getScope().chains.events.collect.add({name:"doAnalytics",fire:function(data,scope){var chain=klevu.getObjectPath(scope.kScope,"chains.actions.doAnalytics");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();}
scope.kScope.data=data;if(data.context.preventDefault===true)return false;}});baseAnalytics.getScope().chains.actions.doAnalytics.add({name:"doRequest",fire:function(data,scope){data.context.doRequest=false;var chain=klevu.getObjectPath(scope.kScope,"chains.request.control");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();scope.kScope.data=data;}else{data.context.preventDefault=true;scope.kScope.data=data;return false;}}});baseAnalytics.getScope().chains.request.ajax.send.add({name:"sendRequest",fire:function(data,scope){if(data.context.eventAction!=="analyticsAjaxV1")return;data.scope=scope;if(data.context.doRequest){klevu.ajax(data.context.url,{method:"GET",data:klevu.queryString(data.request.analytics),dataType:"xml",crossDomain:true,success:function(klXHR){var chain=klevu.getObjectPath(klXHR.requestDetails.scope.kScope,"chains.response.ajax.success");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(klXHR.requestDetails.scope.kElem);klXHR.requestDetails.response.ajax.object=klXHR;klXHR.requestDetails.response.ajax.data=klXHR.responseObj.data;klXHR.requestDetails.context.status=klXHR.status;klXHR.requestDetails.context.isSuccess=klXHR.isSuccess;chain.setData(klXHR.requestDetails);chain.fire();}},done:function(klXHR){var chain=klevu.getObjectPath(klXHR.requestDetails.scope.kScope,"chains.response.ajax.done");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(klXHR.requestDetails.scope.kElem);klXHR.requestDetails.response.ajax.object=klXHR;klXHR.requestDetails.response.ajax.data=klXHR.responseObj.data;klXHR.requestDetails.context.status=klXHR.status;klXHR.requestDetails.context.isSuccess=klXHR.isSuccess;chain.setData(klXHR.requestDetails);chain.fire();}},error:function(klXHR){var chain=klevu.getObjectPath(klXHR.requestDetails.scope.kScope,"chains.response.ajax.fail");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(klXHR.requestDetails.scope.kElem);klXHR.requestDetails.response.ajax.object=klXHR;klXHR.requestDetails.response.ajax.data={};klXHR.requestDetails.context.status=klXHR.status;klXHR.requestDetails.context.isSuccess=klXHR.isSuccess;chain.setData(klXHR.requestDetails);chain.fire();}},requestDetails:data});}else{}}});baseAnalytics.getScope().chains.request.fetch.send.add({name:"sendRequest",fire:function(data,scope){if(data.context.eventAction!=="analyticsFetchV1")return;data.scope=scope;data.context.requestObject={url:data.context.url,type:"FETCH",method:"POST",mimeType:"application/json; charset=UTF-8",contentType:"application/json; charset=utf-8",crossDomain:true,success:function(data,requestDetails,status,isSuccess){var chain=klevu.getObjectPath(requestDetails.scope.kScope,"chains.response.success");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(requestDetails.scope.kElem);klevu.setObjectPath(requestDetails,"response.data",data);klevu.setObjectPath(requestDetails,"context.status",status);klevu.setObjectPath(requestDetails,"context.isSuccess",isSuccess);chain.setData(requestDetails);chain.fire();}},error:function(requestDetails,status,isSuccess){var chain=klevu.getObjectPath(requestDetails.scope.kScope,"chains.response.fail");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(requestDetails.scope.kElem);klevu.setObjectPath(requestDetails,"response.data",{});klevu.setObjectPath(requestDetails,"context.status",status);klevu.setObjectPath(requestDetails,"context.isSuccess",isSuccess);chain.setData(requestDetails);chain.fire();}},data:"["+JSON.stringify(data.request.collect)+"]"};data.context.requestDetails=klevu.extend(true,{},data);}});baseAnalytics.getScope().chains.request.control.add({name:"initRequest",fire:function(data,scope){data.context.doRequest=false;var chain=klevu.getObjectPath(scope.kScope,"chains.request.build");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();scope.kScope.data=data;if(data.context.doRequest===false)return false;}else{data.context.preventDefault=true;scope.kScope.data=data;return false;}}});baseAnalytics.getScope().chains.request.control.add({name:"makeRequest",fire:function(data,scope){var chain=klevu.getObjectPath(scope.kScope,"chains.request.send");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();scope.kScope.data=data;return false;}}});baseAnalytics.getScope().chains.request.build.add({name:"buildMap",fire:function(data,scope){data.context.status=null;data.context.isSuccess=false;data.context.doRequest=true;}});baseAnalytics.getScope().chains.request.send.add({name:"requestTypeAjaxV1",fire:function(data,scope){if(data.context.eventAction==="term"||data.context.eventAction==="click"||data.context.eventAction==="buy"||data.context.eventAction==="catclick"||data.context.eventAction==="catview")
data.context.eventAction="analyticsAjaxV1";}});baseAnalytics.getScope().chains.request.send.add({name:"requestTypeFetchV1",fire:function(data,scope){if(data.context.eventAction==="collect")
data.context.eventAction="analyticsFetchV1";}});baseAnalytics.getScope().chains.request.send.addAfter("requestTypeAjaxV1",{name:"requestEncodeAjaxV1",fire:function(data,scope){if(data.context.eventAction==="analyticsAjaxV1"){var termData=data.request.analytics.klevu_term;if(termData){data.request.analytics.klevu_term=encodeURI(termData);}
var keywordsData=data.request.analytics.klevu_keywords;if(keywordsData){data.request.analytics.klevu_keywords=encodeURI(keywordsData);}}}});baseAnalytics.getScope().chains.request.send.add({name:"requestTypeAjaxSendV1",fire:function(data,scope){if(data.context.eventAction==="analyticsAjaxV1"){var chain=klevu.getObjectPath(scope.kScope,"chains.request.ajax.send");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();scope.kScope.data=data;return false;}}}});baseAnalytics.getScope().chains.request.send.add({name:"requestTypeFetchSendV1",fire:function(data,scope){if(data.context.eventAction==="analyticsFetchV1"){var chain=klevu.getObjectPath(scope.kScope,"chains.request.fetch.send");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.kElem);chain.setData(data);chain.fire();scope.kScope.data=data;}}}});baseAnalytics.getScope().chains.request.send.add({name:"requestSend",fire:function(data,scope){if(data.context.eventAction==="analyticsFetchV1"){klevu.request(data.context.requestObject,data.context.requestDetails);}}});baseAnalytics.getScope().chains.response.ajax.success.add({name:"checkForSuccess",fire:function(data,scope){scope.kScope.data=data;if(data.context.isSuccess===false){return false;}
data.response.current=data.response.ajax.data;}});baseAnalytics.getScope().chains.response.success.add({name:"checkForSuccess",fire:function(data,scope){scope.kScope.data=data;if(data.context.isSuccess===false){return false;}
data.response.current=data.response.ajax.data;}});baseAnalytics.getScope().chains.response.success.add({name:"removeFromDictionary",fire:function(data,scope){if(data.context.callbacks!==false){klevu.each(data.context.callbacks,function(key,callbackObject){callbackObject.fire.apply(this,callbackObject.params);});}}});baseAnalytics.getScope().chains.response.fail.add({name:"removeFromDictionary",fire:function(data,scope){if(data.context.callbacks!==false){klevu.each(data.context.callbacks,function(key,callbackObject){callbackObject.fire.apply(this,callbackObject.params);});}}});klevu.extend(true,klevu,{analytics:{base:baseAnalytics,build:true}});})(klevu);(function(klevu){klevu.extend({pbEvents:{}});klevu.extend(true,klevu.pbEvents,{init:{build:{name:"init-pb",fire:function(){var data={elem:klevu.pb.base};var chain=klevu.pbEvents.init.buildChain;if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(klevu.pb.base.getScope().element);chain.setData(data);chain.fire();}}},buildChain:klevu.chain({stopOnFalse:true})},request:{done:function(options){options.scope.pbObject.removeActiveFile();var filesLeft=klevu.getSetting(options.scope.pbScope.settings,"settings.pagebuild.activeFiles",0);if(filesLeft===0){klevu.event.fireChain(options.scope.pbScope,options.scope.pbScope.data.executeAfter,options.scope.pbScope.element,options.scope.pbScope.data,null);}}}});klevu.pbEvents.init.buildChain.add({name:"checkUrlOverides",fire:function(data,scope){var overrideSettings=klevu.getAllUrlParameters();if(overrideSettings.length>0){klevu.each(overrideSettings,function(key,elem){if(elem.name.startsWith("klib_")){elem.name=elem.name.replace("klib_","").replace(new RegExp(/_/,"g"),".");klevu.setSetting(scope.pbScope.settings,"settings."+elem.name,elem.value);}});}}});klevu.pbEvents.init.buildChain.add({name:"powerUp",fire:function(data,scope){klevu.event.fireChain(scope.pbScope,"chains.coreLoad",scope.pbScope.element,scope.pbScope.data,null);}});klevu.coreEvent.build({name:"buildPb",fire:function(){return!(!klevu.getSetting(klevu.settings,"settings.pagebuild.activate",false)||!klevu.getSetting(klevu.settings,"settings.localSettings",false));}});klevu.coreEvent.attach("buildPb",klevu.extend(true,{},klevu.pbEvents.init.build));klevu.extend({pbObjectBuild:function(){var localVariables={settings:{}};klevu.setObjectPath(localVariables,"id",klevu.randomId());klevu.setObjectPath(localVariables,"chains.coreLoad",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.extraLoad",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.interactive",klevu.chain({stopOnFalse:true}));function init(selfObj){localVariables.element=document.createElement("div");localVariables.element.pbObject=selfObj;localVariables.element.pbScope=localVariables;localVariables.element.pbElem=localVariables.element;}
function buildData(){return{apiKey:false,pageId:false,version:false,url:false,executeAfter:false};}
localVariables.data=buildData();var selfObj={init:init,setScope:function(variables){localVariables=variables;return localVariables;},getScope:function(){return localVariables;},addActiveFile:function(){localVariables.settings.settings.pagebuild.activeFiles++;},removeActiveFile:function(){localVariables.settings.settings.pagebuild.activeFiles--;}};init(selfObj);return selfObj;},pbObjectClone:function(source){var clone=klevu.pbObjectBuild();clone.setScope(klevu.extend(true,{},source.getScope()));clone.getScope().id=klevu.randomId();return clone;}});var options={url:{pbSource:'//js.klevu.com/klevu-js-v2/pagebuilder/'},pagebuild:{active:false,version:"published",nocache:false,activeFiles:0},console:{type:{pb:false}}};klevu(options);})(klevu);(function(klevu){var basePb=klevu.pbObjectBuild();basePb.getScope().chains.coreLoad.add({name:"resetActiveFiles",fire:function(data,scope){var filesLeft=klevu.getSetting(scope.pbScope.settings,"settings.pagebuild.activeFiles",0);if(filesLeft>0){}
klevu.setSetting(scope.pbScope.settings,"settings.pagebuild.activeFiles",0);}});basePb.getScope().chains.coreLoad.add({name:"getPageId",fire:function(data,scope){data.pageId=klevu.getSetting(scope.pbScope.settings,"settings.pagebuild.pageId",false);if(!data.pageId){return false;}}});basePb.getScope().chains.coreLoad.add({name:"getApikey",fire:function(data,scope){data.apiKey=klevu.getSetting(scope.pbScope.settings,"settings.pagebuild.apiKey",klevu.getSetting(scope.pbScope.settings,"settings.search.apiKey",false));if(!data.apiKey){return false;}}});basePb.getScope().chains.coreLoad.add({name:"getVersion",fire:function(data,scope){data.version=klevu.getSetting(scope.pbScope.settings,"settings.pagebuild.version");if(!data.version){return false;}}});basePb.getScope().chains.coreLoad.add({name:"getHostUrl",fire:function(data,scope){data.url=klevu.settings.url.protocol+klevu.getSetting(scope.pbScope.settings,"settings.url.pbSource")+data.apiKey+"/"+data.pageId+"/"+data.version;}});basePb.getScope().chains.coreLoad.add({name:"getCache",fire:function(data,scope){data.nocache=klevu.getSetting(scope.pbScope.settings,"settings.pagebuild.nocache",false);if(data.nocache=='true'){var randomnumber=Math.floor(Math.random()*(1000000000-100000000+1))+100000000;data.nocache="?"+randomnumber;}else{data.nocache="";}}});basePb.getScope().chains.coreLoad.add({name:"setChainAfter",fire:function(data,scope){data.executeAfter="chains.extraLoad";}});basePb.getScope().chains.coreLoad.add({name:"loadJs",fire:function(data,scope){scope.pbObject.addActiveFile();klevu.assets.getFile({url:data.url+".js"+data.nocache,type:"js",options:{scope:scope,successCallback:klevu.pbEvents.request.done,errorCallback:klevu.pbEvents.request.done,}});}});basePb.getScope().chains.coreLoad.add({name:"loadCss",fire:function(data,scope){scope.pbObject.addActiveFile();klevu.assets.getFile({url:data.url+".css"+data.nocache,type:"css",options:{scope:scope,successCallback:klevu.pbEvents.request.done,errorCallback:klevu.pbEvents.request.done}});}});basePb.getScope().chains.extraLoad.add({name:"setChainAfter",fire:function(data,scope){data.executeAfter="chains.interactive";}});klevu.pb={base:basePb};klevu.pb.build=true;})(klevu);(function(klevu){klevu.extend(true,klevu,{recs:{events:{}}});klevu.extend(true,klevu.recs.events,{init:{build:{name:"init-recs",fire:function(){var data={elem:klevu.recs.base};var chain=klevu.recs.events.init.buildChain;if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(klevu.recs.base.getScope().element);chain.setData(data);chain.fire();}}},buildChain:klevu.chain({stopOnFalse:true})},request:{done:function(options){options.scope.recsObject.removeActiveFile();var filesLeft=klevu.getSetting(options.scope.recsScope.settings,"settings.recs.activeFiles",0);if(filesLeft===0){klevu.event.fireChain(options.scope.recsScope,options.scope.recsScope.data.powerUp.executeAfter,options.scope.recsScope.element,options.scope.recsScope.data,null);}}}});klevu.recs.events.init.buildChain.add({name:"checkUrlOverides",fire:function(data,scope){var overrideSettings=klevu.getAllUrlParameters();if(overrideSettings.length>0){klevu.each(overrideSettings,function(key,elem){if(elem.name.startsWith("klib_")){elem.name=elem.name.replace("klib_","").replace(new RegExp(/_/,"g"),".");klevu.setSetting(scope.recsScope.settings,"settings."+elem.name,elem.value);}});}}});klevu.recs.events.init.buildChain.add({name:"powerUp",fire:function(data,scope){klevu.event.fireChain(scope.recsScope,"chains.core.coreLoad",scope.recsScope.element,scope.recsScope.data,null);}});klevu.coreEvent.build({name:"buildRecs",fire:function(){return!(!klevu.getSetting(klevu.settings,"settings.recs.activate",false));}});klevu.coreEvent.attach("buildRecs",klevu.extend(true,{},klevu.recs.events.init.build));klevu.extend(true,klevu,{recs:{list:[],build:function(){var localVariables={settings:{}};klevu.setObjectPath(localVariables,"id",klevu.randomId());klevu.setObjectPath(localVariables,"chains.core.coreLoad",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.core.extraLoad",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.core.interactive",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.actions.load",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.processors.settings",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.request.control",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.request.build",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.request.send",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.request.ajax.send",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.request.fetch.send",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.success",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.done",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.fail",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.ajax.success",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.ajax.done",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.ajax.fail",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.fetch.success",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.fetch.done",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.response.fetch.fail",klevu.chain({stopOnFalse:true}));klevu.setObjectPath(localVariables,"chains.search.control",klevu.chain({stopOnFalse:true}));function init(selfObj,element){localVariables.element=element;localVariables.element.recsObject=selfObj;localVariables.element.recsScope=localVariables;localVariables.element.recsElem=localVariables.element;}
function buildData(){var data={powerUp:{apiKey:false,url:false,executeAfter:false,},context:{eventAction:"",preventDefault:false,status:null,isSuccess:false,apiKey:null,recId:null},request:{settings:{url:null}},response:{}};return data;}
localVariables.data=buildData();var selfObj={init:init,setScope:function(variables){localVariables=variables;return localVariables;},getScope:function(){return localVariables;},addActiveFile:function(){localVariables.settings.settings.recs.activeFiles++;},removeActiveFile:function(){localVariables.settings.settings.recs.activeFiles--;},powerUp:function(){var chain=klevu.getObjectPath(localVariables,"chains.actions.load");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(localVariables.element);chain.setData(localVariables.data);chain.fire();}}};return selfObj;},clone:function(settings){var source=klevu.recs.base;var clone=klevu.recs.build();clone.setScope(klevu.extend(true,{},source.getScope()));clone.init(clone,settings.element);klevu.setSetting(clone.getScope().element.recsScope.settings,"settings.recs.apiKey",settings.apiKey);klevu.setSetting(clone.getScope().element.recsScope.settings,"settings.recs.recId",settings.recId);clone.getScope().id=klevu.randomId();clone.getScope().searchObject=null;clone.getScope().kmcData=null;klevu.recs.list.push(clone);return clone;}}});var options={url:{recsSource:'//js.klevu.com/recs/',recsEndpoint:'//config-cdn.ksearchnet.com/recommendations/'},recs:{active:false,nocache:false,activeFiles:0},console:{type:{recs:false}}};klevu(options);})(klevu);(function(klevu){var baseRecs=klevu.recs.build();baseRecs.getScope().chains.core.coreLoad.add({name:"resetActiveFiles",fire:function(data,scope){var filesLeft=klevu.getSetting(scope.recsScope.settings,"settings.recs.activeFiles",0);if(filesLeft>0){}
klevu.setSetting(scope.recsScope.settings,"settings.recs.activeFiles",0);}});baseRecs.getScope().chains.core.coreLoad.add({name:"getApikey",fire:function(data,scope){data.apiKey=klevu.getSetting(scope.recsScope.settings,"settings.recs.apiKey",klevu.getSetting(scope.recsScope.settings,"settings.search.apiKey",false));if(!data.apiKey){return false;}}});baseRecs.getScope().chains.core.coreLoad.add({name:"getHostUrl",fire:function(data,scope){data.url=klevu.settings.url.protocol+klevu.getSetting(scope.recsScope.settings,"settings.url.recsSource")+data.apiKey+"/";}});baseRecs.getScope().chains.core.coreLoad.add({name:"getCache",fire:function(data,scope){data.nocache=klevu.getSetting(scope.recsScope.settings,"settings.recs.nocache",false);if(data.nocache=='true'){var randomnumber=Math.floor(Math.random()*(1000000000-100000000+1))+100000000;data.nocache="?"+randomnumber;}else{data.nocache="";}}});baseRecs.getScope().chains.core.coreLoad.add({name:"setChainAfter",fire:function(data,scope){data.powerUp.executeAfter="chains.core.extraLoad";}});baseRecs.getScope().chains.core.coreLoad.add({name:"loadJs",fire:function(data,scope){scope.recsObject.addActiveFile();klevu.assets.getFile({url:data.url+".js"+data.nocache,type:"js",options:{scope:scope,successCallback:klevu.recs.events.request.done,errorCallback:klevu.recs.events.request.done,}});}});baseRecs.getScope().chains.core.extraLoad.add({name:"setChainAfter",fire:function(data,scope){data.powerUp.executeAfter="chains.core.interactive";}});baseRecs.getScope().chains.actions.load.add({name:"checkSettings",fire:function(data,scope){var chain=klevu.getObjectPath(scope.recsScope,"chains.processors.settings");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.recsElem);chain.setData(data);chain.fire();}
scope.recsScope.data=data;if(data.context.preventDefault===true)return false;}});baseRecs.getScope().chains.actions.load.add({name:"doRequest",fire:function(data,scope){data.context.doCall=false;var chain=klevu.getObjectPath(scope.recsScope,"chains.request.control");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.recsElem);chain.setData(data);chain.fire();scope.recsScope.data=data;}else{data.context.preventDefault=true;scope.recsScope.data=data;return false;}}});baseRecs.getScope().chains.processors.settings.add({name:"checkDefinedApi",fire:function(data,scope){if(klevu.isUndefined(data.context.recId)){data.context.preventDefault=true;return false;}}});baseRecs.getScope().chains.request.ajax.send.add({name:"sendRequest",fire:function(data,scope){if(data.context.eventAction!=="recsAjax")return;data.scope=scope;if(data.context.doCall){data.context.requestObject={url:data.request.settings.url,type:"AJAX",method:"GET",mimeType:"application/json; charset=UTF-8",contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:true,success:function(klXHR){var chain=klevu.getObjectPath(klXHR.requestDetails.scope.recsScope,"chains.response.success");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(klXHR.requestDetails.scope.recsElem);klevu.setObjectPath(klXHR.requestDetails,"response.data",klXHR.responseObj.data);klevu.setObjectPath(klXHR.requestDetails,"context.status",klXHR.status);klevu.setObjectPath(klXHR.requestDetails,"context.isSuccess",klXHR.isSuccess);chain.setData(klXHR.requestDetails);chain.fire();}},done:function(klXHR){var chain=klevu.getObjectPath(klXHR.requestDetails.scope.recsScope,"chains.response.done");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(klXHR.requestDetails.scope.recsElem);klevu.setObjectPath(klXHR.requestDetails,"response.data",klXHR.responseObj.data);klevu.setObjectPath(klXHR.requestDetails,"context.status",klXHR.status);klevu.setObjectPath(klXHR.requestDetails,"context.isSuccess",klXHR.isSuccess);chain.setData(klXHR.requestDetails);chain.fire();}},error:function(klXHR){var chain=klevu.getObjectPath(klXHR.requestDetails.scope.recsScope,"chains.response.fail");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(klXHR.requestDetails.scope.recsElem);klevu.setObjectPath(klXHR.requestDetails,"response.data",{});klevu.setObjectPath(klXHR.requestDetails,"context.status",klXHR.status);klevu.setObjectPath(klXHR.requestDetails,"context.isSuccess",klXHR.isSuccess);chain.setData(klXHR.requestDetails);chain.fire();}},data:"",};data.context.requestDetails=data;}else{}}});baseRecs.getScope().chains.request.fetch.send.add({name:"sendRequest",fire:function(data,scope){if(data.context.eventAction!=="recsFetch")return;data.scope=scope;if(data.context.doCall){data.context.requestObject={url:data.request.settings.url,type:"FETCH",method:"GET",mimeType:"application/json; charset=UTF-8",contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:true,success:function(data,requestDetails,status,isSuccess){var chain=klevu.getObjectPath(requestDetails.scope.recsScope,"chains.response.success");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(requestDetails.scope.recsElem);klevu.setObjectPath(requestDetails,"response.data",data);klevu.setObjectPath(requestDetails,"context.status",status);klevu.setObjectPath(requestDetails,"context.isSuccess",isSuccess);chain.setData(requestDetails);chain.fire();}},error:function(requestDetails,status,isSuccess){var chain=klevu.getObjectPath(requestDetails.scope.recsScope,"chains.response.fail");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(requestDetails.scope.recsElem);klevu.setObjectPath(requestDetails,"response.data",{});klevu.setObjectPath(requestDetails,"context.status",status);klevu.setObjectPath(requestDetails,"context.isSuccess",isSuccess);chain.setData(requestDetails);chain.fire();}},data:"",};data.context.requestDetails=klevu.extend(true,{},data);}else{}}});baseRecs.getScope().chains.request.control.add({name:"initRequest",fire:function(data,scope){data.context.doCall=true;var chain=klevu.getObjectPath(scope.recsScope,"chains.request.build");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.recsElem);chain.setData(data);chain.fire();scope.recsScope.data=data;if(data.context.doCall===false)return false;}else{data.context.preventDefault=true;scope.recsScope.data=data;return false;}}});baseRecs.getScope().chains.request.control.add({name:"generateURL",fire:function(data,scope){var recsUrl=klevu.getSetting(scope.recsScope.settings,"settings.url.recsEndpoint",false);if(recsUrl){data.request.settings.url=klevu.settings.url.protocol+recsUrl+data.context.apiKey+"/settings/"+data.context.recId;}}});baseRecs.getScope().chains.request.control.add({name:"makeRequest",fire:function(data,scope){var chain=klevu.getObjectPath(scope.recsScope,"chains.request.send");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.recsElem);chain.setData(data);chain.fire();scope.recsScope.data=data;return false;}}});baseRecs.getScope().chains.request.build.add({name:"buildMap",fire:function(data,scope){data.context.status=null;data.context.isSuccess=false;data.context.apiKey=klevu.getSetting(scope.recsScope.settings,"settings.recs.apiKey",klevu.getGlobalSetting("search.apiKey"));data.context.recId=klevu.getSetting(scope.recsScope.settings,"settings.recs.recId",null);data.request.requestObject={};}});baseRecs.getScope().chains.request.send.add({name:"checkFetch",fire:function(data,scope){if(window.fetch){data.context.eventAction="recsFetch";}else{data.context.eventAction="recsAjax";}}});baseRecs.getScope().chains.request.send.add({name:"requestTypeAjax",fire:function(data,scope){if(data.context.eventAction==="searchAjax"){var chain=klevu.getObjectPath(scope.recsScope,"chains.request.ajax.send");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.recsElem);chain.setData(data);chain.fire();scope.recsScope.data=data;}}}});baseRecs.getScope().chains.request.send.add({name:"requestTypeFetch",fire:function(data,scope){if(data.context.eventAction!=="searchAjax"){var chain=klevu.getObjectPath(scope.recsScope,"chains.request.fetch.send");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.recsElem);chain.setData(data);chain.fire();scope.recsScope.data=data;}}}});baseRecs.getScope().chains.request.send.add({name:"requestSend",fire:function(data,scope){klevu.request(data.context.requestObject,data.context.requestDetails);}});baseRecs.getScope().chains.response.success.add({name:"checkForSuccess",fire:function(data,scope){scope.recsElem.data=data;if(data.context.isSuccess===false)return false;}});baseRecs.getScope().chains.response.success.add({name:"executeAjaxResponseProcessor",fire:function(data,scope){if(data.context.eventAction==="recsAjax"){var chain=klevu.getObjectPath(scope.recsScope,"chains.response.ajax.success");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.recsElem);chain.setData(data);chain.fire();}
scope.recsScope.data=data;}}});baseRecs.getScope().chains.response.success.add({name:"executeFetchResponseProcessor",fire:function(data,scope){if(data.context.eventAction==="recsFetch"){var chain=klevu.getObjectPath(scope.recsScope,"chains.response.fetch.success");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.recsElem);chain.setData(data);chain.fire();}
scope.recsScope.data=data;}}});baseRecs.getScope().chains.response.success.add({name:"buildTheSearchObject",fire:function(data,scope){scope.recsScope.searchObject=klevu.searchObjectClone(klevu.search.base);}});baseRecs.getScope().chains.response.success.add({name:"saveSettings",fire:function(data,scope){scope.recsScope.kmcData=klevu.getObjectPath(data.response,"data");}});baseRecs.getScope().chains.response.success.add({name:"executeSearchObjectPowerUp",fire:function(data,scope){var chain=klevu.getObjectPath(scope.recsScope,"chains.search.control");if(!klevu.isUndefined(chain)&&chain.list().length!==0){chain.setScope(scope.recsElem);chain.setData(data);chain.fire();}
scope.recsScope.data=data;}});klevu.extend(true,klevu,{recs:{base:baseRecs,baseBuild:true}});})(klevu);